const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VoiceSelector-CJnWcFHe.js","assets/index-tLXF0cbT.js","assets/index-Ba7vPGC1.css","assets/SpeechSliders-DImJ1TL1.js","assets/index.module-DJ3wk0ll.js","assets/MarkdownHandler-Bx_0r4zD.js"])))=>i.map(i=>d[i]);
import{r as s,j as e,aV as se,aW as re,aX as ne,z as oe,aE as ae,aY as ie,aC as le,_ as Q,b as ce,u as de,f as ue,e as me,R as he,y as K,O as fe,a as q,g as pe,aG as xe,aI as ge,aJ as G}from"./index-tLXF0cbT.js";import{u as be}from"./useLocation-Dkrs0Kvs.js";import{u as je}from"./useQuery-B2b3fnAp.js";import{u as Se}from"./useMutation-DeG93qve.js";import{i as ve,d as we}from"./repo-uUgoOcNV.js";import ye from"./DeleteModal-BxFWKa7q.js";import{P as ke}from"./PageTransition-C1JfaaEv.js";import{M as Ne,O as ze}from"./OfflinePlaceholder-D3ekM9q8.js";import{a as Ce,b as Me}from"./index-CFCga-oC.js";import{l as B}from"./menu-BJbOD8DB.js";function Te(){const t=s.useRef(null),[h,i]=s.useState([]),[c,g]=s.useState(!1),[k,x]=s.useState(!1),[f,b]=s.useState(!0),[P,u]=s.useState(null),V=s.useRef([]),[j,d]=s.useState(0),[S,v]=s.useState([]),N=s.useRef(!0),w=s.useRef(void 0),R=s.useRef({rate:1,pitch:1,volume:1}),o=typeof window<"u"&&"speechSynthesis"in window;s.useEffect(()=>{if(N.current=!0,!o){b(!1),u("Speech synthesis is not supported by your browser.");return}t.current=window.speechSynthesis;const r=()=>{const a=t.current.getVoices();a.length>0?(i(a),b(!1),u(null)):setTimeout(r,1500)};return b(!0),r(),t.current.onvoiceschanged=r,()=>{N.current=!1,_(),t.current&&(t.current.onvoiceschanged=null)}},[o]);const z=(r,a)=>{const y=[];let l=0;for(;l<r.length;){let m=l+a;if(m<r.length){for(;m>l&&r[m]!==" ";)m--;m===l&&(m=l+a)}else m=r.length;const p=r.slice(l,m).trim();for(p.length>0&&y.push(p),l=m;l<r.length&&r[l]===" ";)l++}return y},I=(r,a,y=1,l=1,m=1)=>{const p=new SpeechSynthesisUtterance(r),F=a?h.find(C=>C.name===a):h[0];return F&&(p.voice=F),p.rate=Math.min(Math.max(y,.1),10),p.pitch=Math.min(Math.max(l,0),2),p.volume=Math.min(Math.max(m,0),1),p.onerror=C=>{u(`Speech Error: ${C.error}`),g(!1),x(!1)},p},L=(r,a,y=1,l=1,m=1,p=0)=>{if(!r||!o||!t.current||f){u("Cannot speak: Voices are still loading or not supported.");return}_(),w.current=a,R.current={rate:y,pitch:l,volume:m};const F=r.trim().replace(/\s+/g," "),C=z(F,300);v(C),d(p);const E=C.slice(p).map((O,$)=>{const D=I(O,a,y,l,m);return D.onstart=()=>{d(p+$),g(!0),x(!1)},D.onend=()=>{$===C.length-p-1&&(g(!1),x(!1),d(C.length-1))},D});V.current=E,E.forEach(O=>t.current.speak(O))},U=r=>{if(r<0||r>=S.length||!t.current)return;_();const{rate:a,pitch:y,volume:l}=R.current;L(S.join(" "),w.current,a,y,l,r)},_=()=>{!o||!t.current||(t.current.cancel(),g(!1),x(!1),u(null),V.current=[])};return{voices:h,speak:L,pause:()=>{!o||!t.current||!c||k||(t.current.pause(),x(!0))},resume:()=>{!o||!t.current||!c||!k||(t.current.resume(),x(!1))},stop:_,isSpeaking:c,isPaused:k,isSupported:o,isLoadingVoices:f,error:P,chunks:S,currentChunkIndex:j,goToChunk:U}}const Ve=s.lazy(()=>Q(()=>import("./VoiceSelector-CJnWcFHe.js"),__vite__mapDeps([0,1,2]))),Pe=s.lazy(()=>Q(()=>import("./SpeechSliders-DImJ1TL1.js"),__vite__mapDeps([3,1,2,4]))),J=(t,h)=>t.trim().split(/\s+/).length/3/h,Y=t=>{const h=Math.floor(t/60),i=Math.floor(t%60);return`${String(h).padStart(2,"0")}:${String(i).padStart(2,"0")}`},Ee=({text:t,className:h})=>{const{voices:i,speak:c,pause:g,resume:k,stop:x,isSpeaking:f,isPaused:b,isSupported:P,isLoadingVoices:u,error:V,chunks:j,currentChunkIndex:d,goToChunk:S}=Te(),[v,N]=s.useState(),[w,R]=s.useState(1),[o,z]=s.useState(1),[I,L]=s.useState(1),[U,_]=s.useState(!1),[X,H]=s.useState(""),[r,a]=s.useState(!1),[y,l]=s.useState(!1);s.useEffect(()=>{if(u||i.length===0)return;const n=localStorage.getItem("selectedVoice");if(n&&i.some(M=>M.name===n))N(n);else{const M=i.find(A=>A.localService)||i[0];N(M?.name),n&&n!==M?.name&&console.warn(`Stored voice "${n}" not found, using default.`)}},[i,u]),s.useEffect(()=>()=>x(),[]),s.useEffect(()=>{!f&&!b&&r&&d>=j.length-1&&a(!1)},[f,b,r,d,j.length]);const m=()=>{!t||i.length===0||u||(f?b?k():g():(c(t,v,w,o,I),a(!0)))},p=()=>{x(),a(!1)},F=n=>{N(n),n?localStorage.setItem("selectedVoice",n):localStorage.removeItem("selectedVoice"),f&&(x(),c(t,n,w,o,I,d),a(!0))},C=(n,M)=>{n==="rate"&&R(M),n==="pitch"&&z(M),n==="volume"&&L(M),f&&(x(),c(t,v,w,o,I,d),a(!0))},E=j.length,O=J(j.slice(0,d).join(" "),w),$=J(t,w),D=(n,M)=>{const A=M.getBoundingClientRect(),Z=n-A.left,ee=Math.min(Math.max(Z/A.width,0),1),te=Math.floor(ee*E);S(te),a(!0)},W=!f&&d>=E-1?100:d/(E||1)*100;return e.jsxs("div",{className:`relative ${h??""}`,children:[!f&&!r&&e.jsx("button",{onClick:m,disabled:u||!P||i.length===0,className:"inline-flex items-center py-2.5 px-3 hover:cursor-pointer bg-blue-600 border-blue-500 rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Start Speech",title:"Start Speech",children:e.jsx(Ne,{size:18})}),(f||r)&&e.jsxs("div",{className:"fixed bottom-0 left-0 h-13 md:h-max md:left-33 w-[100dvw] md:w-[calc(100vw-8.6rem)] bg-secondary border-t-border py-2 flex justify-center md:gap-10 gap-3 items-center z-50 shadow-lg",children:[e.jsxs("div",{className:"absolute top-0 left-2 md:w-[98%] w-[95%] mr-10 h-1 cursor-pointer bg-border rounded",onClick:n=>D(n.clientX,n.currentTarget),onMouseDown:()=>l(!0),onMouseUp:()=>l(!1),onMouseMove:n=>{y&&D(n.clientX,n.currentTarget)},children:[e.jsx("div",{className:"h-1 bg-primary transition-all duration-300",style:{width:`${W}%`}}),e.jsx("div",{className:"absolute top-[-4px] -translate-x-1/2 w-3 h-3 rounded-full bg-primary text-sm border border-border shadow",style:{left:`${W}%`}})]}),e.jsxs("span",{className:"absolute top-1 text-foreground left-2 md:text-sm text-[11px] font-mono",children:[Y(O)," / ",Y($)]}),e.jsx("button",{onClick:p,className:"text-foreground hover:cursor-pointer","aria-label":"Stop",title:"Stop",children:e.jsx(se,{size:18})}),e.jsx("button",{onClick:()=>{S(d-1),a(!0)},disabled:d===0,className:"text-foreground hover:cursor-pointer disabled:opacity-50","aria-label":"Previous Chunk",title:"Previous Chunk",children:e.jsx(Ce,{size:18})}),e.jsx("button",{onClick:m,className:"text-white bg-teal-600 rounded-full p-3 mt-1 hover:cursor-pointer hover:bg-teal-700","aria-label":f&&!b?"Pause":"Play",title:f&&!b?"Pause":"Play",children:f&&!b?e.jsx(re,{size:18}):e.jsx(ne,{size:18})}),e.jsx("button",{onClick:()=>{S(d+1),a(!0)},disabled:d>=E-1,className:"text-foreground hover:cursor-pointer disabled:opacity-50","aria-label":"Next Chunk",title:"Next Chunk",children:e.jsx(Me,{size:18})}),e.jsxs(B,{as:"div",className:"relative",children:[e.jsx(B.Button,{className:"text-foreground focus:outline-none hover:cursor-pointer mt-1 transition-colors duration-200","aria-label":"Reading Settings",title:"Reading Settings",disabled:u||!P,children:({open:n})=>e.jsx(oe,{show:!0,appear:!0,enter:"transition-opacity duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:n?e.jsx(ae,{size:18}):e.jsx(ie,{size:18})})}),e.jsx(B.Items,{className:"absolute right-1/2 bottom-7 mb-2 w-64 bg-secondary border border-border rounded-md shadow-lg p-4 space-y-4 max-h-[400px] overflow-auto z-50",children:e.jsxs(s.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(le,{className:"animate-spin text-primary min-h-[310px] max-w-[50px] text-4xl"})}),children:[V&&e.jsx("div",{className:"text-red-600 text-sm mb-2",children:V}),u&&e.jsx("div",{className:"text-muted-foreground text-sm mb-2",children:"Loading voices..."}),e.jsx(Ve,{voices:i,selectedVoice:v,isDropdownOpen:U,setDropdownOpen:_,searchTerm:X,setSearchTerm:H,handleVoiceChange:F,isLoadingVoices:u}),e.jsx(Pe,{rate:w,pitch:o,volume:I,onChange:C})]})})]})]})]})},T=t=>t.replace(/<[^>]+>/g,"").replace(/{[^}]+}/g,"").replace(/&[a-zA-Z0-9#]+;/g,"").replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim();function Re(t,h){let i="";t.forEach(g=>{i+=" "+T(g.content),g.subsections?.forEach(k=>{i+=" "+T(k.title||""),i+=" "+T(k.description||"")})}),h?.content&&(i+=" "+T(h.content));const c=i.split(" ").filter(Boolean).length;return Math.ceil(c/200)}function Be(){const{isAuthenticated:t,isSuperUser:h}=ce(),{id:i}=de({strict:!1}),c=Number(i),g=be(),k=ue(),x=me(),f=g.pathname.includes("/edit"),[b,P]=s.useState(!1),{data:u,error:V}=je({queryKey:["tetelDetail",c],queryFn:()=>we(c),enabled:!isNaN(c)&&c>0,retry:2,refetchOnWindowFocus:!1});s.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[g.pathname]);const j=he.lazy(()=>Q(()=>import("./MarkdownHandler-Bx_0r4zD.js").then(o=>o.M),__vite__mapDeps([5,1,2]))),d=Se({mutationFn:()=>{if(!t||!h)throw K.error("Nincs engedélyed a művelethez"),new Error("Nincs engedélyed a művelethez");return ve(c)},onSuccess:()=>{x.invalidateQueries({queryKey:["tetelek"]}),K.success("Sikeresen törölted a tételt."),k({to:"/tetelek"})}});if(V)return navigator.onLine?e.jsxs("div",{className:"p-10 text-red-500 text-center",children:["Hiba történt: ",V.message]}):e.jsx(ze,{});if(f)return e.jsx(fe,{});const S=u?.tetel??{name:"Ismeretlen tétel"},v=u?.osszegzes,N=u?.sections??[],w=Re(N,v),R=[T(S.name),...N.flatMap(o=>[T(o.content),...o.subsections?.flatMap(z=>[T(z.title||""),T(z.description||"")])??[]]),v?.content?"Összegzés: "+T(v.content):""].filter(o=>o&&o.length>0).join(" ").trim();return e.jsx(s.Suspense,{children:e.jsxs("main",{className:"relative md:max-w-[75dvw] max-w-full mb-5 mx-auto mt-10 md:px-0 px-2 pt-10 pb-1 text-left",children:[e.jsxs(ke,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs(q,{to:"/tetelek/$id",params:{id:c.toString()},className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tétel áttekintéséhez",title:"Vissza a tételhez",children:[e.jsx(pe,{className:"mr-2","aria-hidden":"true"}),"Vissza"]}),e.jsxs("div",{className:"flex items-center gap-4 ",children:[e.jsxs("span",{className:"text-sm mx-auto text-secondary-foreground",children:[e.jsx(xe,{className:"inline mr-1",size:15,"aria-hidden":"true"}),w," perc"]}),e.jsx(Ee,{text:R})]})]}),e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-foreground",children:S.name}),e.jsxs("div",{className:"space-y-6",children:[N.map(o=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow-xl border border-transparent hover:border-border transition-colors",children:[e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-secondary rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsx("div",{className:"text-xl font-semibold mb-4 text-foreground",children:e.jsx(j,{content:o.content})})}),o.subsections?.map(z=>e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-muted rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium text-foreground mb-2",children:e.jsx(j,{content:z.title})}),e.jsx("div",{className:"text-secondary-foreground prose prose-invert max-w-none",children:e.jsx(j,{content:z.description})})]})},z.id))]},o.id)),v?.content&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 border border-transparent hover:border-border transition-colors",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-foreground",children:"Összegzés"}),e.jsx("div",{className:"text-foreground prose prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(j,{content:v.content})})]})]}),e.jsx(ye,{isOpen:b,onClose:()=>P(!1),onDelete:()=>d.mutate(),isDeleting:d.isPending,itemName:S.name})]}),t&&h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>P(!0),className:"fixed md:bottom-2 bottom-14 right-2 p-3 bg-rose-600 text-white rounded-full hover:bg-rose-700 hover:cursor-pointer transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Töröld a tételt","aria-label":"Töröld a tételt",children:e.jsx(ge,{size:20,"aria-hidden":"true"})}),e.jsx(q,{to:"/tetelek/$id/details/edit",params:{id:c.toString()},className:"fixed md:bottom-16 bottom-28 right-2 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(G,{size:20,"aria-hidden":"true"})})]}):t?e.jsx(q,{to:"/tetelek/$id/details/edit",params:{id:c.toString()},className:"fixed md:bottom-2 bottom-14 right-2 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(G,{size:20,"aria-hidden":"true"})}):null]})})}export{Be as T};
