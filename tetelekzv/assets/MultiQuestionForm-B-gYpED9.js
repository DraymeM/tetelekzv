import{d as K,b as M,r as a,y as v,j as t,N as P,S as z}from"./index-Devi4yYS.js";import{u as B}from"./useMutation-BqAPE7zp.js";import{z as l,F as I,S as L}from"./SubmitButton-blNto2aN.js";import{a as T}from"./repo-Br9-sPjB.js";import{Q as V,A as D}from"./AnswerInput-BZYQg_kQ.js";const R=l.object({text:l.string().min(1,"A válasz szövege nem lehet üres"),isCorrect:l.boolean()}),C=l.object({question:l.string().min(1,"A kérdés megadása kötelező"),answers:l.array(R).length(4,"Pontosan négy válasz szükséges").refine(i=>i.some(c=>c.isCorrect),{message:"Legalább egy válasznak helyesnek kell lennie"})}),W=()=>{const i=K(),c=M(),[o,h]=a.useState(""),[n,p]=a.useState([{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]),[q,u]=a.useState(null),[y,m]=a.useState(null),[g,w]=a.useState({question:void 0,answers:[null,null,null,null]}),[b,f]=a.useState({question:!1,answers:[!1,!1,!1,!1]}),[,S]=a.useState(!1),[E,d]=a.useState(!1),j=B({mutationFn:e=>T(e),onMutate:()=>{d(!0)},onSuccess:()=>{c.invalidateQueries({queryKey:["multiQuestions"]}),h(""),p([{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]),u(null),w({question:void 0,answers:[null,null,null,null]}),f({question:!1,answers:[!1,!1,!1,!1]}),S(!1),v.success("Kérdés létrehozva!"),m("Kérdés létrehozva!"),setTimeout(()=>{m(null),d(!1),i({to:"/mquestions"})},2e3)},onError:e=>{var s,r;v.error("Nem sikerült a kérdés létrehozása!"),u(((r=(s=e.response)==null?void 0:s.data)==null?void 0:r.error)||e.message||"Nem sikerült a kérdés létrehozása"),d(!1)}});a.useEffect(()=>{const e=C.safeParse({question:o,answers:n}),s={question:void 0,answers:[null,null,null,null]};e.success||e.error.errors.forEach(r=>{r.path[0]==="question"?s.question=r.message:r.path[0]==="answers"&&typeof r.path[1]=="number"&&(s.answers[r.path[1]]=r.message)}),w(s)},[o,n]);const N=(e,s,r)=>{const x=[...n];x[e]={...x[e],[s]:r},p(x),f(k=>({...k,answers:k.answers.map((A,F)=>F===e?!0:A)}))},Q=e=>{e.preventDefault(),u(null),m(null),S(!0);const s=C.safeParse({question:o,answers:n});if(!s.success){u(s.error.errors[0].message),f({question:!0,answers:[!0,!0,!0,!0]});return}j.mutate({question:o,answers:n})};return t.jsxs(a.Suspense,{fallback:t.jsx(z,{}),children:[t.jsx(P,{}),E&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundColor:"rgba(25, 25, 30, 0.3)"},children:t.jsx(z,{})}),t.jsx("div",{className:"max-w-4xl mx-auto items-center mt-10",children:t.jsx(I,{error:q,success:y,label:"Új Felelet Választós Kérdés",children:t.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[t.jsx(V,{question:o,setQuestion:h,fieldErrors:g,touched:b}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Válaszok"}),n.map((e,s)=>t.jsx(D,{answer:e,index:s,updateAnswer:N,fieldErrors:g.answers[s],touched:b.answers[s]},s))]}),t.jsx(L,{isPending:j.isPending,label:"Kérdés Létrehozása"})]})})})]})};export{W as M};
