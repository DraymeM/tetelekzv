const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VoiceSelector-CWMqpu5N.js","assets/index-Da3SL0Ls.js","assets/index-DyXJHkpK.css","assets/SpeechSliders-BAS7veN6.js","assets/index.module-DIQ7CQmW.js","assets/MarkdownHandler-DwzMLGMo.js"])))=>i.map(i=>d[i]);
import{r,j as e,z as D,aV as q,aW as B,aX as Q,aE as H,aY as K,aC as W,_ as I,b as G,u as J,f as X,e as Y,R as Z,y as A,O as ee,a as L,g as te,aG as re,aI as se,aJ as U}from"./index-Da3SL0Ls.js";import{u as ne}from"./useLocation-C_4TUHFB.js";import{u as ae}from"./useQuery-C0u9K6l1.js";import{u as oe}from"./useMutation-OHOf3G-S.js";import{i as ie,d as ce}from"./repo-DXDMeu9J.js";import le from"./DeleteModal-cADjeiNF.js";import{P as ue}from"./PageTransition-BMVerCWI.js";import{M as de,O as me}from"./OfflinePlaceholder-B8O3MXt6.js";import{l as O}from"./menu-DELT4jqb.js";function fe(){const t=r.useRef(null),[m,u]=r.useState([]),[o,w]=r.useState(!1),[j,c]=r.useState(!1),[P,k]=r.useState(!0),[M,g]=r.useState(null),s=r.useRef([]),n=r.useRef(0),d=r.useRef(!0),z=r.useRef("unknown"),y=r.useRef(!1),f=r.useRef({rate:1,pitch:1,volume:1}),b=r.useRef(""),p=typeof window<"u"&&"speechSynthesis"in window;r.useEffect(()=>{const a=navigator.userAgent.toLowerCase();y.current=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(a),a.includes("chrome")?z.current="chrome":a.includes("firefox")?z.current="firefox":a.includes("safari")?z.current="safari":a.includes("edge")&&(z.current="edge")},[]),r.useEffect(()=>{if(d.current=!0,!p){k(!1),g("Speech synthesis is not supported by your browser.");return}return t.current=window.speechSynthesis,(async()=>{if(!t.current)return;const h=5;let v=0;const i=()=>{const x=t.current.getVoices();x.length>0?d.current&&(u(x),k(!1),g(null)):v<h?(v++,setTimeout(i,1500)):d.current&&(k(!1),g("Failed to load voices after multiple attempts."))};k(!0),i(),t.current.onvoiceschanged=i})(),()=>{d.current=!1,R(),t.current&&(t.current.onvoiceschanged=null)}},[p]);const T=(a,h,v=1,i=1,x=1)=>{const S=new SpeechSynthesisUtterance(a);let F=h?m.find(V=>V.name===h):null;return F||(F=y.current&&m.find(V=>V.localService)||m[0]),F&&(S.voice=F),S.rate=Math.min(Math.max(v,.1),10),S.pitch=Math.min(Math.max(i,0),2),S.volume=Math.min(Math.max(x,0),1),S.onstart=()=>{d.current&&(w(!0),c(!1),g(null))},S.onend=()=>{if(d.current)if(n.current++,n.current<s.current.length)t.current.speak(s.current[n.current]);else if(b.current){const V=b.current.slice(0,300);b.current=b.current.slice(300),s.current=[T(V,h,f.current.rate,f.current.pitch,f.current.volume)],n.current=0,V?t.current.speak(s.current[0]):(w(!1),c(!1),n.current=0,s.current=[],b.current="")}else w(!1),c(!1),n.current=0,s.current=[],b.current=""},S.onerror=V=>{const $=`Speech Error: ${V.error}`;d.current&&(w(!1),c(!1),g($),F&&!F.localService&&m.find(C=>C.localService)&&l(a,m.find(C=>C.localService)?.name,v,i,x))},S.onpause=()=>c(!0),S.onresume=()=>c(!1),S},l=(a,h,v=1,i=1,x=1)=>{if(!a||!p||!t.current||P){g("Cannot speak: Voices are still loading or not supported.");return}R(),f.current={rate:v,pitch:i,volume:x};const S=a.trim().replace(/\s+/g," "),F=S.match(/\S.{0,298}\s/g)||[S];s.current=[T(F[0]||"",h,v,i,x)],b.current=F.slice(1).join(""),n.current=0,t.current.cancel(),s.current.length>0&&t.current.speak(s.current[0])},N=a=>{f.current={...f.current,...a};for(let h=n.current;h<s.current.length;h++){const v=s.current[h];a.rate&&(v.rate=Math.min(Math.max(a.rate,.1),10)),a.pitch&&(v.pitch=Math.min(Math.max(a.pitch,0),2)),a.volume&&(v.volume=Math.min(Math.max(a.volume,0),1))}if(o&&!j&&n.current<s.current.length){t.current.cancel();const h=s.current[n.current]?.text||"";s.current[n.current]=T(h,s.current[n.current]?.voice?.name,f.current.rate,f.current.pitch,f.current.volume),t.current.speak(s.current[n.current])}},E=()=>{!p||!t.current||!o||j||(t.current.pause(),c(!0))},_=()=>{!p||!t.current||!o||!j||(z.current==="safari"||y.current?n.current<s.current.length&&(t.current.cancel(),t.current.speak(s.current[n.current])):(t.current.resume(),c(!1)))},R=()=>{!p||!t.current||(t.current.cancel(),d.current&&(w(!1),c(!1),g(null),s.current=[],n.current=0,b.current=""))};return{voices:m,speak:l,pause:E,resume:_,stop:R,updateParams:N,isSpeaking:o,isPaused:j,isSupported:p,isLoadingVoices:P,error:M}}const pe=r.lazy(()=>I(()=>import("./VoiceSelector-CWMqpu5N.js"),__vite__mapDeps([0,1,2]))),he=r.lazy(()=>I(()=>import("./SpeechSliders-BAS7veN6.js"),__vite__mapDeps([3,1,2,4]))),xe=({text:t,className:m})=>{const{voices:u,speak:o,pause:w,resume:j,stop:c,updateParams:P,isSpeaking:k,isPaused:M,isSupported:g,isLoadingVoices:s,error:n}=fe(),[d,z]=r.useState(),[y,f]=r.useState(1),[b,p]=r.useState(1),[T,l]=r.useState(1),[N,E]=r.useState(!1),[_,R]=r.useState("");r.useEffect(()=>{if(u.length>0&&!d&&!s){const i=u.find(x=>x.localService)||u[0];z(i?.name)}},[u,d,s]),r.useEffect(()=>()=>c(),[]);const a=()=>{!t||u.length===0||s||(k?M?j():w():o(t,d,y,b,T))},h=i=>{z(i),E(!1),k&&(c(),o(t,i,y,b,T))},v=(i,x)=>{i==="rate"&&f(x),i==="pitch"&&p(x),i==="volume"&&l(x),P({[i]:x})};return e.jsxs("div",{className:`relative ${m??""}`,children:[!k&&e.jsx("button",{onClick:a,disabled:s||!g||u.length===0,className:"inline-flex items-center py-2.5 px-3 bg-blue-600 border-blue-500 hover:cursor-pointer rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Start Speech",title:"Start Speech",children:e.jsx(de,{size:18})}),e.jsx(D,{show:k,enter:"transition transform ease-out duration-300",enterFrom:"translate-y-full opacity-0",enterTo:"translate-y-0 opacity-100",leave:"transition transform ease-in duration-200",leaveFrom:"translate-y-0 opacity-100",leaveTo:"translate-y-full opacity-0",children:e.jsxs("div",{className:"fixed bottom-0 left-0 h-13 md:h-max md:left-33 w-[100dvw] md:w-[calc(100vw-8.25rem)] bg-secondary border-t-border border-t-2 py-2 flex justify-center gap-10 items-center z-50 shadow-lg",children:[e.jsx("button",{onClick:c,className:"text-foreground focus:outline-none hover:cursor-pointer transition-colors duration-200","aria-label":"Stop",title:"Stop",children:e.jsx(q,{size:18})}),e.jsx("button",{onClick:a,className:"text-white focus:outline-none bg-teal-600 bottom-1 rounded-full p-3 hover:bg-teal-700 hover:cursor-pointer transition-colors duration-200","aria-label":M?"Resume":"Pause",title:M?"Resume":"Pause",children:e.jsx(D,{show:!0,appear:!0,enter:"transition-opacity duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:M?e.jsx(B,{size:18}):e.jsx(Q,{size:18})})}),e.jsxs(O,{as:"div",className:"relative",children:[e.jsx(O.Button,{className:"text-foreground focus:outline-none hover:cursor-pointer transition-colors duration-200","aria-label":"Felolvasási Beállítások",title:"Felolvasási Beállítások",disabled:s||!g,children:({open:i})=>e.jsx(D,{show:!0,appear:!0,enter:"transition-opacity duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:i?e.jsx(H,{size:18}):e.jsx(K,{size:18})})}),e.jsx(O.Items,{className:"absolute right-1/2 bottom-5 mb-2 w-64 bg-secondary border border-border rounded-md shadow-lg p-4 space-y-4 max-h-[400px] overflow-auto z-50",children:e.jsxs(r.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(W,{className:"animate-spin text-primary min-h-[300px] max-w-[50px] text-4xl"})}),children:[n&&e.jsx("div",{className:"text-red-600 text-sm mb-2",children:n}),s&&e.jsx("div",{className:"text-gray-600 text-sm mb-2",children:"Loading voices..."}),e.jsx(pe,{voices:u,selectedVoice:d,isDropdownOpen:N,setDropdownOpen:E,searchTerm:_,setSearchTerm:R,handleVoiceChange:h}),e.jsx(he,{rate:y,pitch:b,volume:T,onChange:v})]})})]})]})})]})};function ge(t,m){const u=j=>j.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim();let o="";t.forEach(j=>{o+=" "+u(j.content),j.subsections?.forEach(c=>{o+=" "+u(c.title||""),o+=" "+u(c.description||"")})}),m?.content&&(o+=" "+u(m.content));const w=o.split(" ").filter(Boolean).length;return Math.ceil(w/200)}function Me(){const{isAuthenticated:t,isSuperUser:m}=G(),{id:u}=J({strict:!1}),o=Number(u),w=ne(),j=X(),c=Y(),P=w.pathname.includes("/edit"),[k,M]=r.useState(!1),{data:g,error:s}=ae({queryKey:["tetelDetail",o],queryFn:()=>ce(o),enabled:!isNaN(o)&&o>0,retry:2,refetchOnWindowFocus:!1});r.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[w.pathname]);const n=Z.lazy(()=>I(()=>import("./MarkdownHandler-DwzMLGMo.js").then(l=>l.M),__vite__mapDeps([5,1,2]))),d=oe({mutationFn:()=>{if(!t||!m)throw A.error("Nincs engedélyed a művelethez"),new Error("Nincs engedélyed a művelethez");return ie(o)},onSuccess:()=>{c.invalidateQueries({queryKey:["tetelek"]}),A.success("Sikeresen törölted a tételt."),j({to:"/tetelek"})}});if(s)return navigator.onLine?e.jsxs("div",{className:"p-10 text-red-500 text-center",children:["Hiba történt: ",s.message]}):e.jsx(me,{});if(P)return e.jsx(ee,{});const z=g?.tetel??{name:"Ismeretlen tétel"},y=g?.osszegzes,f=g?.sections??[],b=ge(f,y),p=l=>l.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim(),T=[p(z.name),...f.flatMap(l=>[p(l.content),...l.subsections?.flatMap(N=>[p(N.title||""),p(N.description||"")])??[]]),y?.content?"Összegzés: "+p(y.content):""].filter(l=>l&&l.length>0).join(" ").trim();return e.jsx(r.Suspense,{children:e.jsxs("main",{className:"relative md:max-w-[75dvw] max-w-full mb-5 mx-auto mt-10 md:px-0 px-2 pt-10 pb-1 text-left",children:[e.jsxs(ue,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs(L,{to:"/tetelek/$id",params:{id:o.toString()},className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tétel áttekintéséhez",title:"Vissza a tételhez",children:[e.jsx(te,{className:"mr-2","aria-hidden":"true"}),"Vissza"]}),e.jsxs("div",{className:"flex items-center gap-4 ",children:[e.jsxs("span",{className:"text-sm mx-auto text-secondary-foreground",children:[e.jsx(re,{className:"inline mr-1",size:15,"aria-hidden":"true"}),b," perc"]}),e.jsx(xe,{text:T})]})]}),e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-foreground",children:z.name}),e.jsxs("div",{className:"space-y-6",children:[f.map(l=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow-xl border border-transparent hover:border-border transition-colors",children:[e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"bg-secondary rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsx("div",{className:"text-xl font-semibold mb-4 text-foreground",children:e.jsx(n,{content:l.content})})}),l.subsections?.map(N=>e.jsx(r.Suspense,{fallback:e.jsx("div",{className:"bg-muted rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium text-foreground mb-2",children:e.jsx(n,{content:N.title})}),e.jsx("div",{className:"text-secondary-foreground prose prose-invert max-w-none",children:e.jsx(n,{content:N.description})})]})},N.id))]},l.id)),y?.content&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 border border-transparent hover:border-border transition-colors",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-foreground",children:"Összegzés"}),e.jsx("div",{className:"text-foreground prose prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(n,{content:y.content})})]})]}),e.jsx(le,{isOpen:k,onClose:()=>M(!1),onDelete:()=>d.mutate(),isDeleting:d.isPending,itemName:z.name})]}),t&&m?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>M(!0),className:"fixed md:bottom-2 bottom-14 right-2 p-3 bg-rose-600 text-white rounded-full hover:bg-rose-700 hover:cursor-pointer transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Töröld a tételt","aria-label":"Töröld a tételt",children:e.jsx(se,{size:20,"aria-hidden":"true"})}),e.jsx(L,{to:"/tetelek/$id/details/edit",params:{id:o.toString()},className:"fixed md:bottom-16 bottom-28 right-2 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(U,{size:20,"aria-hidden":"true"})})]}):t?e.jsx(L,{to:"/tetelek/$id/details/edit",params:{id:o.toString()},className:"fixed md:bottom-2 bottom-14 right-2 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(U,{size:20,"aria-hidden":"true"})}):null]})})}export{Me as T};
