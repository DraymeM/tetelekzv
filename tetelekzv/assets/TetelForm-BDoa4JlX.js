import{j as e,B as E,F,r as b,N as I,y as q}from"./index-GncX1r6g.js";import{z as a,F as M,S as Q}from"./SubmitButton-B8SN_Nro.js";import{I as k}from"./InputField-BbTPsTCZ.js";const A=a.preprocess(t=>t!==void 0?Number(t):void 0,a.number()).optional(),X=a.object({id:A,title:a.string().min(1,"A cím nem lehet üres!"),description:a.string()}),Y=a.object({id:A,content:a.string().min(1,"A szekció tartalma nem lehet üres!"),subsections:a.array(X).nullable().transform(t=>t||[])}),Z=a.object({id:A,question:a.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz."),answer:a.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz.")}),B=a.object({name:a.string().min(1,"Tétel cím megadása kötelező!"),osszegzes:a.string().min(1,"Összegzés megadása kötelező!"),sections:a.array(Y).min(1,"Legalább egy szekció legyen!"),flashcards:a.array(Z).nullable().transform(t=>t||[])}),R=({label:t,value:i,onChange:u,error:c})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:t}),e.jsx("textarea",{rows:4,className:`w-full p-2 rounded bg-secondary text-foreground focus:outline-none focus:ring-2 focus:ring-primary ${c?"border border-red-500":"border border-border"}`,value:i,onChange:u}),c&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:c})]}),D=({subsection:t,onUpdate:i,onRemove:u,errors:c={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:u,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(k,{label:"Cím",value:t.title,onChange:d=>i("title",d.target.value),error:c.title}),e.jsx(R,{label:"Leírás",value:t.description,onChange:d=>i("description",d.target.value),error:c.description})]}),ee=({onUpdateContent:t,onAddSubsection:i,onRemoveSection:u,onUpdateSubsection:c,onRemoveSubsection:d,section:f,errors:j={}})=>e.jsxs("div",{className:"p-4 border rounded-lg border-border relative group",children:[e.jsx("button",{type:"button",onClick:u,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(R,{label:"Szekció tartalma",value:f.content,onChange:m=>t(m.target.value),error:j.content}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-foreground",children:"Alszekciók"}),f.subsections.map((m,x)=>e.jsx(D,{subsection:m,onRemove:()=>d(x),onUpdate:(p,y)=>c(x,p,y),errors:{title:j[`subsections.${x}.title`],description:j[`subsections.${x}.description`]}},x)),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:i,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Alszekció"})]})]})]}),se=({flashcard:t,onUpdate:i,onRemove:u,errors:c={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:u,className:"absolute -top-3 -right-3 text-red-500 bg-secondary rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx("hr",{className:"border-t-2 border-border w-full my-2"}),e.jsx(k,{label:"Kérdés",value:t.question,onChange:d=>i("question",d.target.value),error:c.question}),e.jsx(k,{label:"Válasz",value:t.answer,onChange:d=>i("answer",d.target.value),error:c.answer})]}),ne=({initialData:t,onSubmit:i,isPending:u,error:c,success:d,label:f,submitLabel:j})=>{const[m,x]=b.useState((t==null?void 0:t.name)||""),[p,y]=b.useState((t==null?void 0:t.osszegzes)||""),[v,g]=b.useState((t==null?void 0:t.sections)||[{content:"",subsections:[]}]),[z,w]=b.useState((t==null?void 0:t.flashcards)||[]),[S,T]=b.useState({}),[N,C]=b.useState({});b.useEffect(()=>{const s=B.safeParse({name:m,osszegzes:p,sections:v,flashcards:z});if(s.success)T({});else{const r={};s.error.errors.forEach(n=>{r[n.path.join(".")]=n.message}),T(r)}},[m,p,v,z]);const U=s=>{s.preventDefault(),C({name:!0,osszegzes:!0,sections:!0,flashcards:!0});const r=B.safeParse({name:m,osszegzes:p,sections:v,flashcards:z});if(!r.success){q.error("Javítsd ki a hibákat mielőtt mentenél!");return}i(r.data),q.success("Sikeres mentés!")},O=()=>{g(s=>[...s,{id:Date.now()*-1,content:"",subsections:[]}])},P=s=>{g(r=>r.filter(n=>n.id!==s))},L=(s,r)=>{g(n=>n.map(o=>o.id===s?{...o,content:r}:o))},W=s=>{g(r=>r.map(n=>n.id===s?{...n,subsections:[...n.subsections,{id:Date.now()*-1,title:"",description:""}]}:n))},J=(s,r,n,o)=>{g(l=>l.map(h=>h.id===s?{...h,subsections:h.subsections.map(($,H)=>H===r?{...$,[n]:o}:$)}:h))},K=(s,r)=>{g(n=>n.map(o=>o.id===s?{...o,subsections:o.subsections.filter((l,h)=>h!==r)}:o))},V=()=>{w(s=>[...s,{id:Date.now()*-1,question:"",answer:""}])},_=(s,r,n)=>{w(o=>o.map(l=>l.id===s?{...l,[r]:n}:l))},G=s=>{w(r=>r.filter(n=>n.id!==s))};return b.useEffect(()=>{(c||d)&&window.scrollTo({top:0,behavior:"smooth"})},[c,d]),e.jsxs("div",{children:[e.jsx(I,{}),e.jsx("div",{className:"max-w-6xl mx-auto items-center",children:e.jsx(M,{error:c,success:d,label:f,children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsx(k,{label:"Tétel címe",value:m,onChange:s=>{x(s.target.value),C(r=>({...r,name:!0}))},error:N.name?S.name:void 0}),e.jsx(R,{label:"Összegzés",value:p,onChange:s=>{y(s.target.value),C(r=>({...r,osszegzes:!0}))},error:N.osszegzes?S.osszegzes:void 0}),v.map((s,r)=>{const n={};return Object.entries(S).forEach(([o,l])=>{o.startsWith(`sections.${r}.`)&&(n[o.replace(`sections.${r}.`,"")]=l)}),e.jsx(ee,{index:s.id,section:s,onUpdateContent:o=>L(s.id,o),onAddSubsection:()=>W(s.id),onRemoveSection:()=>P(s.id),onUpdateSubsection:(o,l,h)=>J(s.id,o,l,h),onRemoveSubsection:o=>K(s.id,o),errors:N.sections?n:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:O,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Szekció"})]}),z.map((s,r)=>{const n={};return Object.entries(S).forEach(([o,l])=>{o.startsWith(`flashcards.${r}.`)&&(n[o.replace(`flashcards.${r}.`,"")]=l)}),e.jsx(se,{flashcard:s,onUpdate:(o,l)=>_(s.id,o,l),onRemove:()=>G(s.id),errors:N.flashcards?n:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:V,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új flashcard"})]}),e.jsx(Q,{isPending:u,label:j})]})})})]})};export{ne as default};
