const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VoiceSelector-zFgQbU2g.js","assets/index-DNiFvfeI.js","assets/index-BvcWFGXJ.css","assets/SpeechSliders-BfCmpu7R.js","assets/index.module-C00NBq74.js","assets/MarkdownHandler-CPdxIUTn.js"])))=>i.map(i=>d[i]);
import{r as s,j as e,aV as ee,aW as te,aX as se,z as re,aE as ne,aY as ae,aC as oe,_ as U,b as ie,u as le,f as ce,e as de,R as ue,y as H,O as me,a as $,g as he,aG as pe,aI as fe,aJ as K}from"./index-DNiFvfeI.js";import{u as xe}from"./useLocation-D6bTaUz_.js";import{u as ge}from"./useQuery-B8gxA_6d.js";import{u as be}from"./useMutation-Xzz3cmAe.js";import{i as je,d as ve}from"./repo-06h-nJQE.js";import Se from"./DeleteModal-B5DWn1NT.js";import{P as we}from"./PageTransition-Xf4wLMEY.js";import{M as ke,O as ye}from"./OfflinePlaceholder-Bql1SMz_.js";import{a as Ne,b as ze}from"./index-B80Fber4.js";import{l as A}from"./menu-19dgea4-.js";function Me(){const t=s.useRef(null),[p,a]=s.useState([]),[r,S]=s.useState(!1),[v,c]=s.useState(!1),[y,N]=s.useState(!0),[R,d]=s.useState(null),T=s.useRef([]),[M,u]=s.useState(0),[w,j]=s.useState([]),C=s.useRef(!0),k=s.useRef(void 0),f=typeof window<"u"&&"speechSynthesis"in window;s.useEffect(()=>{if(C.current=!0,!f){N(!1),d("Speech synthesis is not supported by your browser.");return}t.current=window.speechSynthesis;const n=()=>{const g=t.current.getVoices();g.length>0?(a(g),N(!1),d(null)):setTimeout(n,1500)};return N(!0),n(),t.current.onvoiceschanged=n,()=>{C.current=!1,_(),t.current&&(t.current.onvoiceschanged=null)}},[f]);const V=(n,g)=>{const b=[];let m=0;for(;m<n.length;){let h=m+g;if(h<n.length){for(;h>m&&n[h]!==" ";)h--;h===m&&(h=m+g)}else h=n.length;const l=n.slice(m,h).trim();for(l.length>0&&b.push(l),m=h;m<n.length&&n[m]===" ";)m++}return b},i=(n,g,b=1,m=1,h=1)=>{const l=new SpeechSynthesisUtterance(n),F=g?p.find(z=>z.name===g):p[0];return F&&(l.voice=F),l.rate=Math.min(Math.max(b,.1),10),l.pitch=Math.min(Math.max(m,0),2),l.volume=Math.min(Math.max(h,0),1),l.onerror=z=>{d(`Speech Error: ${z.error}`),S(!1),c(!1)},l},x=(n,g,b=1,m=1,h=1,l=0)=>{if(!n||!f||!t.current||y){d("Cannot speak: Voices are still loading or not supported.");return}_(),k.current=g;const F=n.trim().replace(/\s+/g," "),z=V(F,300);j(z),u(l);const I=z.slice(l).map((P,O)=>{const D=i(P,g,b,m,h);return D.onstart=()=>{u(l+O),S(!0),c(!1)},D.onend=()=>{O===z.length-l-1&&(S(!1),c(!1),u(z.length-1))},D});T.current=I,I.forEach(P=>t.current.speak(P))},L=n=>{n<0||n>=w.length||!t.current||(_(),x(w.join(" "),k.current,1,1,1,n))},_=()=>{!f||!t.current||(t.current.cancel(),S(!1),c(!1),d(null),T.current=[])};return{voices:p,speak:x,pause:()=>{!f||!t.current||!r||v||(t.current.pause(),c(!0))},resume:()=>{!f||!t.current||!r||!v||(t.current.resume(),c(!1))},stop:_,isSpeaking:r,isPaused:v,isSupported:f,isLoadingVoices:y,error:R,chunks:w,currentChunkIndex:M,goToChunk:L}}const Ce=s.lazy(()=>U(()=>import("./VoiceSelector-zFgQbU2g.js"),__vite__mapDeps([0,1,2]))),Te=s.lazy(()=>U(()=>import("./SpeechSliders-BfCmpu7R.js"),__vite__mapDeps([3,1,2,4]))),W=(t,p)=>t.trim().split(/\s+/).length/3/p,G=t=>{const p=Math.floor(t/60),a=Math.floor(t%60);return`${String(p).padStart(2,"0")}:${String(a).padStart(2,"0")}`},Ve=({text:t,className:p})=>{const{voices:a,speak:r,pause:S,resume:v,stop:c,isSpeaking:y,isPaused:N,isSupported:R,isLoadingVoices:d,error:T,chunks:M,currentChunkIndex:u,goToChunk:w}=Me(),[j,C]=s.useState(),[k,f]=s.useState(1),[V,i]=s.useState(1),[x,L]=s.useState(1),[_,q]=s.useState(!1),[B,n]=s.useState(""),[g,b]=s.useState(!1),[m,h]=s.useState(!1);s.useEffect(()=>{if(a.length>0&&!j&&!d){const o=a.find(E=>E.localService)||a[0];C(o?.name)}},[a,j,d]),s.useEffect(()=>()=>c(),[]);const l=()=>{!t||a.length===0||d||(y?N?v():S():(r(t,j,k,V,x),b(!0)))},F=()=>{c(),b(!1)},z=o=>{C(o),y&&(c(),r(t,o,k,V,x,u),b(!0))},I=(o,E)=>{o==="rate"&&f(E),o==="pitch"&&i(E),o==="volume"&&L(E),y&&(c(),r(t,j,k,V,x,u),b(!0))},P=M.length,O=W(M.slice(0,u).join(" "),k),D=W(t,k),Q=(o,E)=>{const X=E.getBoundingClientRect(),J=o-X.left,Y=Math.min(Math.max(J/X.width,0),1),Z=Math.floor(Y*P);w(Z),b(!0)};return e.jsxs("div",{className:`relative ${p??""}`,children:[!y&&!g&&e.jsx("button",{onClick:l,disabled:d||!R||a.length===0,className:"inline-flex items-center py-2.5 px-3 hover:cursor-pointer bg-blue-600 border-blue-500 rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Start Speech",title:"Start Speech",children:e.jsx(ke,{size:18})}),(y||g)&&e.jsxs("div",{className:"fixed bottom-0 left-0 h-13 md:h-max md:left-33 w-[100dvw] md:w-[calc(100vw-8.6rem)] bg-secondary border-t-border py-2 flex justify-center md:gap-10 gap-3 items-center z-50 shadow-lg",children:[e.jsxs("div",{className:"absolute top-0 left-2 md:w-[98%] w-[95%] mr-10 h-1 cursor-pointer bg-border rounded",onClick:o=>Q(o.clientX,o.currentTarget),onMouseDown:()=>h(!0),onMouseUp:()=>h(!1),onMouseMove:o=>{m&&Q(o.clientX,o.currentTarget)},children:[e.jsx("div",{className:"h-1 bg-primary transition-all duration-300",style:{width:`${u/(P||1)*100}%`}}),e.jsx("div",{className:"absolute top-[-4px] -translate-x-1/2 w-3 h-3 rounded-full bg-primary text-sm border border-border shadow",style:{left:`${u/(P||1)*100}%`}})]}),e.jsxs("span",{className:"absolute top-1 text-foreground left-2 md:text-sm text-[11px] font-mono",children:[G(O)," / ",G(D)]}),e.jsx("button",{onClick:F,className:"text-foreground hover:cursor-pointer","aria-label":"Stop",title:"Stop",children:e.jsx(ee,{size:18})}),e.jsx("button",{onClick:()=>{w(u-1),b(!0)},disabled:u===0,className:"text-foreground hover:cursor-pointer disabled:opacity-50","aria-label":"Previous Chunk",title:"Previous Chunk",children:e.jsx(Ne,{size:18})}),e.jsx("button",{onClick:l,className:"text-white bg-teal-600 rounded-full p-3 mt-1 hover:cursor-pointer hover:bg-teal-700","aria-label":N?"Resume":"Pause",title:N?"Resume":"Pause",children:N?e.jsx(te,{size:18}):e.jsx(se,{size:18})}),e.jsx("button",{onClick:()=>{w(u+1),b(!0)},disabled:u>=P-1,className:"text-foreground hover:cursor-pointer disabled:opacity-50","aria-label":"Next Chunk",title:"Next Chunk",children:e.jsx(ze,{size:18})}),e.jsxs(A,{as:"div",className:"relative",children:[e.jsx(A.Button,{className:"text-foreground focus:outline-none hover:cursor-pointer mt-1 transition-colors duration-200","aria-label":"Reading Settings",title:"Reading Settings",disabled:d||!R,children:({open:o})=>e.jsx(re,{show:!0,appear:!0,enter:"transition-opacity duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:o?e.jsx(ne,{size:18}):e.jsx(ae,{size:18})})}),e.jsx(A.Items,{className:"absolute right-1/2 bottom-7 mb-2 w-64 bg-secondary border border-border rounded-md shadow-lg p-4 space-y-4 max-h-[400px] overflow-auto z-50",children:e.jsxs(s.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(oe,{className:"animate-spin text-primary min-h-[310px] max-w-[50px] text-4xl"})}),children:[T&&e.jsx("div",{className:"text-red-600 text-sm mb-2",children:T}),d&&e.jsx("div",{className:"text-muted-foreground text-sm mb-2",children:"Loading voices..."}),e.jsx(Ce,{voices:a,selectedVoice:j,isDropdownOpen:_,setDropdownOpen:q,searchTerm:B,setSearchTerm:n,handleVoiceChange:z}),e.jsx(Te,{rate:k,pitch:V,volume:x,onChange:I})]})})]})]})]})};function Pe(t,p){const a=v=>v.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim();let r="";t.forEach(v=>{r+=" "+a(v.content),v.subsections?.forEach(c=>{r+=" "+a(c.title||""),r+=" "+a(c.description||"")})}),p?.content&&(r+=" "+a(p.content));const S=r.split(" ").filter(Boolean).length;return Math.ceil(S/200)}function Ue(){const{isAuthenticated:t,isSuperUser:p}=ie(),{id:a}=le({strict:!1}),r=Number(a),S=xe(),v=ce(),c=de(),y=S.pathname.includes("/edit"),[N,R]=s.useState(!1),{data:d,error:T}=ge({queryKey:["tetelDetail",r],queryFn:()=>ve(r),enabled:!isNaN(r)&&r>0,retry:2,refetchOnWindowFocus:!1});s.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[S.pathname]);const M=ue.lazy(()=>U(()=>import("./MarkdownHandler-CPdxIUTn.js").then(i=>i.M),__vite__mapDeps([5,1,2]))),u=be({mutationFn:()=>{if(!t||!p)throw H.error("Nincs engedélyed a művelethez"),new Error("Nincs engedélyed a művelethez");return je(r)},onSuccess:()=>{c.invalidateQueries({queryKey:["tetelek"]}),H.success("Sikeresen törölted a tételt."),v({to:"/tetelek"})}});if(T)return navigator.onLine?e.jsxs("div",{className:"p-10 text-red-500 text-center",children:["Hiba történt: ",T.message]}):e.jsx(ye,{});if(y)return e.jsx(me,{});const w=d?.tetel??{name:"Ismeretlen tétel"},j=d?.osszegzes,C=d?.sections??[],k=Pe(C,j),f=i=>i.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim(),V=[f(w.name),...C.flatMap(i=>[f(i.content),...i.subsections?.flatMap(x=>[f(x.title||""),f(x.description||"")])??[]]),j?.content?"Összegzés: "+f(j.content):""].filter(i=>i&&i.length>0).join(" ").trim();return e.jsx(s.Suspense,{children:e.jsxs("main",{className:"relative md:max-w-[75dvw] max-w-full mb-5 mx-auto mt-10 md:px-0 px-2 pt-10 pb-1 text-left",children:[e.jsxs(we,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs($,{to:"/tetelek/$id",params:{id:r.toString()},className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tétel áttekintéséhez",title:"Vissza a tételhez",children:[e.jsx(he,{className:"mr-2","aria-hidden":"true"}),"Vissza"]}),e.jsxs("div",{className:"flex items-center gap-4 ",children:[e.jsxs("span",{className:"text-sm mx-auto text-secondary-foreground",children:[e.jsx(pe,{className:"inline mr-1",size:15,"aria-hidden":"true"}),k," perc"]}),e.jsx(Ve,{text:V})]})]}),e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-foreground",children:w.name}),e.jsxs("div",{className:"space-y-6",children:[C.map(i=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow-xl border border-transparent hover:border-border transition-colors",children:[e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-secondary rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsx("div",{className:"text-xl font-semibold mb-4 text-foreground",children:e.jsx(M,{content:i.content})})}),i.subsections?.map(x=>e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-muted rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium text-foreground mb-2",children:e.jsx(M,{content:x.title})}),e.jsx("div",{className:"text-secondary-foreground prose prose-invert max-w-none",children:e.jsx(M,{content:x.description})})]})},x.id))]},i.id)),j?.content&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 border border-transparent hover:border-border transition-colors",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-foreground",children:"Összegzés"}),e.jsx("div",{className:"text-foreground prose prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(M,{content:j.content})})]})]}),e.jsx(Se,{isOpen:N,onClose:()=>R(!1),onDelete:()=>u.mutate(),isDeleting:u.isPending,itemName:w.name})]}),t&&p?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>R(!0),className:"fixed md:bottom-2 bottom-14 right-2 p-3 bg-rose-600 text-white rounded-full hover:bg-rose-700 hover:cursor-pointer transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Töröld a tételt","aria-label":"Töröld a tételt",children:e.jsx(fe,{size:20,"aria-hidden":"true"})}),e.jsx($,{to:"/tetelek/$id/details/edit",params:{id:r.toString()},className:"fixed md:bottom-16 bottom-28 right-2 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(K,{size:20,"aria-hidden":"true"})})]}):t?e.jsx($,{to:"/tetelek/$id/details/edit",params:{id:r.toString()},className:"fixed md:bottom-2 bottom-14 right-2 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(K,{size:20,"aria-hidden":"true"})}):null]})})}export{Ue as T};
