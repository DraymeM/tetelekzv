const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PlayPauseControls-aDKTNTWZ.js","assets/index-Bc-TEnXl.js","assets/index-DTVxlJdK.css","assets/index-B49JrhAU.js","assets/VoiceSelector-Cl2Ap2o1.js","assets/SpeechSliders-DbBLbrMj.js","assets/MarkdownHandler-DzWXpNWf.js"])))=>i.map(i=>d[i]);
import{j as e,z as B,o as q,r as s,S as M,v as Q,w as $,_ as P,d as K,b as H,g as U,f as W,R as G,y as C,O as J,a as E,i as O,p as X,s as Y,x as Z,A as ee}from"./index-Bc-TEnXl.js";import{u as te}from"./useLocation-pIOquBxz.js";import{u as se}from"./useQuery-C5ai4iQq.js";import{u as ne}from"./useMutation-D7gXzaIV.js";import{N as V}from"./Navbar-CIlctuKW.js";import{g as re,h as oe}from"./repo-GSrZrFi-.js";import ae from"./DeleteModal-HGEqYIuf.js";import{P as ie}from"./PageTransition-CsJlB4zd.js";import le from"./FlashCard-BBA9rnkV.js";import{O as ce}from"./OfflinePlaceholder-CsIyf-ev.js";import{l as D}from"./menu-CKUM6Byn.js";import"./index-B49JrhAU.js";import"./index-D_WForPF.js";import"./use-resolve-button-type-CCS8F59k.js";import"./bugs-ChikpICQ.js";import"./label-5GdVdr0n.js";const de=({questions:t,currentIdx:c,onNext:n,onExit:r})=>{const l=t.length>0,d=t.length>1;return e.jsx(B,{show:!0,enter:"transition-opacity duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",as:"div",children:e.jsx("div",{className:"flex flex-col items-center gap-6 mt-10",children:l&&e.jsxs(e.Fragment,{children:[e.jsx(le,{question:t[c]?.question??"",answer:t[c]?.answer??""}),e.jsxs("div",{className:"flex gap-4",children:[d&&e.jsxs("button",{onClick:n,className:`px-6 py-3 bg-orange-400 text-white rounded-lg hover:cursor-pointer\r
                             hover:bg-orange-600 transition-colors flex items-center`,children:[e.jsx(q,{className:"mr-2 animate-spin"}),"Következő kérdés"]}),e.jsx("button",{onClick:r,className:`px-6 py-3 border border-border text-muted-foreground hover:text-foreground hover:cursor-pointer\r
                             rounded-lg hover:bg-secondary transition-colors`,children:"Vissza"})]})]})})})};function ue(){const t=window.speechSynthesis,[c,n]=s.useState([]),[r,l]=s.useState(!1),[d,a]=s.useState(!1),x=s.useRef(null),h=()=>new Promise(m=>{let o=t.getVoices();if(o.length>0)n(o),m(o);else{const b=setInterval(()=>{o=t.getVoices(),o.length>0&&(clearInterval(b),n(o),m(o))},100)}});s.useEffect(()=>(h(),"onvoiceschanged"in t&&(t.onvoiceschanged=h),()=>{"onvoiceschanged"in t&&(t.onvoiceschanged=null)}),[]);const p=(m,o,b=1,S=1,j=1)=>{if(!m)return;k();const i=new SpeechSynthesisUtterance(m);if(o){const v=c.find(y=>y.name===o);v&&(i.voice=v)}i.rate=b,i.pitch=S,i.volume=j,i.onstart=()=>{l(!0),a(!1)},i.onend=()=>{l(!1),a(!1)},i.onerror=()=>{l(!1),a(!1)},x.current=i,t.speak(i)},g=()=>{t.speaking&&!t.paused&&(t.pause(),a(!0))},w=()=>{t.paused&&(t.resume(),a(!1))},k=()=>{t.cancel(),l(!1),a(!1)};return{voices:c,speak:p,pause:g,resume:w,stop:k,isSpeaking:r,isPaused:d}}const me=s.lazy(()=>P(()=>import("./PlayPauseControls-aDKTNTWZ.js"),__vite__mapDeps([0,1,2,3]))),xe=s.lazy(()=>P(()=>import("./VoiceSelector-Cl2Ap2o1.js"),__vite__mapDeps([4,1,2]))),he=s.lazy(()=>P(()=>import("./SpeechSliders-DbBLbrMj.js"),__vite__mapDeps([5,1,2]))),pe=({text:t,className:c})=>{const{voices:n,speak:r,pause:l,resume:d,stop:a,isSpeaking:x,isPaused:h}=ue(),[p,g]=s.useState(),[w,k]=s.useState(1),[m,o]=s.useState(1),[b,S]=s.useState(1),[j,i]=s.useState(!1),[v,y]=s.useState("");s.useEffect(()=>{n.length>0&&!p&&g(n[0].name)},[n,p]),s.useEffect(()=>()=>window.speechSynthesis.cancel(),[]);const F=()=>{!t||n.length===0||(x?h?d():l():r(t,p,w,m,b))},N=f=>{g(f),i(!1),x&&a()},T=(f,_)=>{f==="rate"&&k(_),f==="pitch"&&o(_),f==="volume"&&S(_),x&&a()};return e.jsx(D,{as:"div",className:`relative inline-block text-left ${c??""}`,children:({open:f})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-0",children:[e.jsx(s.Suspense,{fallback:e.jsx(M,{}),children:e.jsx(me,{isSpeaking:x,isPaused:h,hasVoices:n.length>0,onClick:F})}),e.jsx(D.Button,{className:"inline-flex items-center px-2 py-2.5 bg-blue-600 border-l-2 border-blue-800 hover:cursor-pointer rounded-r-md text-sm font-medium text-white hover:bg-blue-700","aria-label":"Felolvasási Beállítások",title:"Felolvasási Beállítások",children:e.jsx(Q,{size:16,className:`transition-transform duration-300 ${f?"rotate-180":"rotate-0"}`})})]}),e.jsx(D.Items,{className:"absolute right-0 mt-2 w-64 bg-secondary border border-border rounded-md shadow-lg p-4 space-y-4 max-h-[400px] overflow-auto z-50",children:e.jsxs(s.Suspense,{fallback:e.jsx(M,{}),children:[e.jsx(xe,{voices:n,selectedVoice:p,isDropdownOpen:j,setDropdownOpen:i,searchTerm:v,setSearchTerm:y,handleVoiceChange:N}),e.jsx(he,{rate:w,pitch:m,volume:b,onChange:T}),e.jsx("div",{className:"flex justify-between mt-2",children:e.jsxs("button",{onClick:a,disabled:!x,className:`inline-flex items-center px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition ${x?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx($,{}),e.jsx("span",{className:"ml-2",children:"Stop"})]})})]})})]})})};function fe(t,c){const n=d=>d.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim();let r="";t.forEach(d=>{r+=" "+n(d.content),d.subsections?.forEach(a=>{r+=" "+n(a.title||""),r+=" "+n(a.description||"")})}),c?.content&&(r+=" "+n(c.content));const l=r.split(" ").filter(Boolean).length;return Math.ceil(l/200)}function ge(){const{isAuthenticated:t,isSuperUser:c}=K(),{id:n}=H({strict:!1}),r=Number(n),l=te(),d=U(),a=W(),x=l.pathname.includes("/edit"),[h,p]=s.useState(!1),[g,w]=s.useState(0),[k,m]=s.useState(!1),{data:o,isLoading:b,error:S}=se({queryKey:["tetelDetail",r],queryFn:()=>oe(r),enabled:!isNaN(r)&&r>0,retry:2,refetchOnWindowFocus:!1});s.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[l.pathname]);const j=G.lazy(()=>P(()=>import("./MarkdownHandler-DzWXpNWf.js").then(u=>u.M),__vite__mapDeps([6,1,2]))),i=ne({mutationFn:()=>{if(!t||!c)throw C.error("Nincs engedélyed a művelethez"),new Error("Nincs engedélyed a művelethez");return re(r)},onSuccess:()=>{a.invalidateQueries({queryKey:["tetelek"]}),C.success("Sikeresen törölted a tételt."),d({to:"/tetelek"})}});if(b)return e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx("div",{className:"p-10 text-center",children:e.jsx(M,{})})]});if(S)return navigator.onLine?e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("div",{className:"p-10 text-red-500 text-center",children:["Hiba történt: ",S.message]})]}):e.jsx(e.Fragment,{children:e.jsx(ce,{})});if(x)return e.jsx(J,{});const v=o?.tetel??{name:"Ismeretlen tétel"},y=o?.osszegzes,F=o?.sections??[],N=o?.questions??[],T=N.length>0,f=N.length>1,_=fe(F,y),R=!/Mobi|Android|iPhone|iPad/i.test(navigator.userAgent)&&!("standalone"in window.navigator&&window.navigator.standalone)&&!window.matchMedia("(display-mode: standalone)").matches,I=[v.name,...F.flatMap(u=>[u.content,...u.subsections?.flatMap(z=>[z.title,z.description])??[]]),"Összegzés:",y?.content??"","Vége"].filter(Boolean).join(". "),L=()=>{if(!f)return;let u=g;for(;u===g;)u=Math.floor(Math.random()*N.length);w(u)},A=()=>{T&&(w(Math.floor(Math.random()*N.length)),p(!0))};return e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx(s.Suspense,{fallback:e.jsx(M,{}),children:e.jsxs("main",{className:"relative md:max-w-7xl max-w-full mx-auto min-h-screen mt-10 md:px-10 px-3 py-10 text-left",children:[e.jsxs(ie,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs(E,{to:"/tetelek",className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tételekhez",title:"Vissza a tételekhez",children:[e.jsx(O,{className:"mr-2"}),"Tételekhez"]}),e.jsxs("div",{className:"flex items-center md:gap-4 gap-1",children:[!h&&e.jsxs("span",{className:"text-sm mx-auto text-secondary-foreground",children:[e.jsx(X,{className:"inline mr-1",size:15}),_," perc"]}),!h&&R&&e.jsx(pe,{text:I}),!h&&T&&e.jsx("button",{onClick:A,className:"inline-flex items-center px-4 py-2 bg-purple-600 border-purple-500 rounded-md text-sm font-medium text-white hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-colors hover:cursor-pointer","aria-label":"Tanulás",title:"Tanulás",children:e.jsx(Y,{size:20})})]})]}),e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-foreground",children:v.name}),h?e.jsx(de,{questions:N,currentIdx:g,onNext:L,onExit:()=>p(!1)}):e.jsxs("div",{className:"space-y-6",children:[F.map(u=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow-xl border border-transparent hover:border-border transition-colors",children:[e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-secondary rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsx("div",{className:"text-xl font-semibold mb-4 text-foreground",children:e.jsx(j,{content:u.content})})}),u.subsections?.map(z=>e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-muted rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium text-foreground mb-2",children:e.jsx(j,{content:z.title})}),e.jsx("div",{className:"text-secondary-foreground prose prose-invert max-w-none",children:e.jsx(j,{content:z.description})})]},z.id)}))]},u.id)),y?.content&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 border border-transparent hover:border-border transition-colors",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-foreground",children:"Összegzés"}),e.jsx("div",{className:"text-foreground prose prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(j,{content:y.content})})]}),e.jsxs(E,{to:"/tetelek",className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tételekhez",title:"Vissza a tételekhez",children:[e.jsx(O,{className:"mr-2"}),"Tételekhez"]})]}),e.jsx(ae,{isOpen:k,onClose:()=>m(!1),onDelete:()=>i.mutate(),isDeleting:i.isPending,itemName:v.name})]}),t&&e.jsxs(e.Fragment,{children:[e.jsx(E,{to:"/tetelek/$id/edit",params:{id:r.toString()},className:"fixed bottom-22 right-7 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt",children:e.jsx(Z,{size:20})}),e.jsx("button",{onClick:()=>{if(!t){C.error("Ehhez be kell jelentkezned!");return}m(!0)},className:"fixed bottom-7 right-7 p-3 bg-rose-600 text-white rounded-full hover:bg-rose-700 transition-all transform hover:scale-105 flex items-center hover:cursor-pointer justify-center z-50",title:"Töröld a tételt",children:e.jsx(ee,{size:20})})]})]})})]})}const Ve=ge;export{Ve as component};
