import{r as s,j as e,z as k,L as F,g as I,k as O,aV as $,aW as H,aX as Y,aY as B,h as J,i as W,u as X,f as Z,S as A,a as _,aC as ee,l as se}from"./index-CjHgB-9B.js";import{u as Q}from"./useQuery-7hYlgJGr.js";import{h as te,g as ae}from"./repo-CMdqNkwN.js";import{P as re}from"./PageTransition-CV3Y8buX.js";import{O as ne}from"./OfflinePlaceholder-BRjtviK7.js";import{u as ie}from"./useOnlineStatus-BHyzc8OP.js";import{u as le,T as oe}from"./useTimer-Cy2TUesp.js";import de from"./AnswerPicker-8mKPEe-r.js";import{b as ce}from"./index-mUgmeXuP.js";import{c as me}from"./index.module-BGvm5te1.js";const S=[{threshold:85,icon:e.jsx(O,{className:"text-4xl text-green-600"}),message:"Fantasztikus munka! Igazi bajnok vagy!"},{threshold:75,icon:e.jsx($,{className:"text-4xl text-lime-600"}),message:"Nagyszerű eredmény! Csak így tovább!"},{threshold:60,icon:e.jsx(H,{className:"text-4xl text-amber-500"}),message:"Szép munka, már majdnem tökéletes!"},{threshold:50,icon:e.jsx(Y,{className:"text-4xl text-orange-600"}),message:"Jó kezdet! Gyakorolj még egy kicsit!"},{threshold:0,icon:e.jsx(B,{className:"text-4xl text-rose-600"}),message:"Ne csüggedj, legközelebb jobb lesz!"}];function xe({isOpen:o,score:a,total:n,onClose:w}){const t=n>0?a/n*100:0,[u,f]=s.useState(0),[h,b]=s.useState(!1),c=s.useRef(null),{start:N}=ce.useCountUp({ref:c,start:0,end:t,duration:3,startOnMount:!1,useEasing:!0});s.useEffect(()=>{if(o){f(0),b(!1),requestAnimationFrame(()=>{f(t)});const d=setTimeout(()=>{N()},100),p=setTimeout(()=>{b(!0)},3e3);return()=>{clearTimeout(d),clearTimeout(p)}}},[o,t,N]);const{icon:m,message:g}=S.find(d=>t>=d.threshold)??S[S.length-1];return e.jsx(k,{appear:!0,show:o,as:s.Fragment,children:e.jsxs(F,{as:"div",className:"relative z-10",onClose:()=>{},children:[e.jsx(k.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/80"})}),e.jsx("div",{className:"fixed inset-0 overflow-y-auto",children:e.jsx("div",{className:"flex min-h-full items-center justify-center p-4 text-center",children:e.jsx(k.Child,{as:s.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 scale-95",enterTo:"opacity-100 scale-100",leave:"ease-in duration-200",leaveFrom:"opacity-100 scale-100",leaveTo:"opacity-0 scale-95",children:e.jsxs(F.Panel,{className:"w-full max-w-md border-border border-2 transform overflow-hidden rounded-xl bg-secondary p-6 text-center align-middle shadow-xl transition-all",children:[e.jsx(F.Title,{as:"h3",className:"text-2xl leading-6 text-foreground font-bold mb-4",children:"Teszt Eredmények"}),e.jsxs("p",{className:"text-sm text-foreground mb-2",children:["Helyes válaszok:"," ",e.jsx("span",{className:"font-semibold text-green-500",children:a}),"/",n]}),e.jsxs("div",{className:"flex flex-col space-y-3 w-full items-center",children:[e.jsx("span",{ref:c,className:"text-2xl font-bold text-primary"}),e.jsx("div",{className:"w-full max-w-xs h-4 bg-border rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full transition-all duration-1500 ease-in-out",style:{width:`${u}%`,backgroundColor:"var(--primary)"},role:"progressbar","aria-valuenow":u,"aria-valuemin":0,"aria-valuemax":100,"aria-label":"Teszt eredmény előrehaladás"})})]}),h&&e.jsxs("div",{className:"mt-4 flex flex-col items-center space-y-2",children:[e.jsx("span",{"aria-hidden":"true",children:m}),e.jsx("p",{className:"text-sm text-foreground",children:g})]}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs("button",{type:"button",className:"inline-flex items-center px-3 py-2 border border-border hover:cursor-pointer rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors",onClick:w,"aria-label":"Vissza a kérdésekhez",title:"Vissza a kérdésekhez",children:[e.jsx(I,{className:"mr-2","aria-hidden":"true"}),"Vissza a kérdésekhez"]})})]})})})})]})})}function ue({score:o,questionsAnswered:a,streak:n}){return e.jsxs("div",{className:"flex flex-row md:gap-6 gap-2 mb-6 text-muted-foreground text-sm justify-center",children:[e.jsxs("div",{className:"flex items-center md:gap-2 gap-1 bg-green-100/20 md:px-4 px-2 py-2 rounded-md shadow-sm",children:[e.jsx(J,{className:"text-green-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-foreground",children:["Válaszok:"," ",e.jsx("span",{className:"font-semibold text-green-500",children:o})]})]}),e.jsxs("div",{className:"flex items-center md:gap-2 gap-1 bg-blue-100/20 md:px-4 px-2 py-2 rounded-md shadow-sm",children:[e.jsx(W,{className:"text-blue-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-foreground",children:["Kérdések:"," ",e.jsx("span",{className:"font-semibold text-blue-500",children:a})]})]}),e.jsxs("div",{className:"flex items-center md:gap-2 gap-1 bg-yellow-100/20 md:px-4 px-2 py-2 rounded-md shadow-sm",children:[e.jsx(O,{className:"text-yellow-500","aria-hidden":"true"}),e.jsxs("span",{className:"text-foreground",children:["Sorozat:"," ",e.jsx("span",{className:"font-semibold text-yellow-500",children:n})]})]})]})}function we(){const{id:o}=X({strict:!1}),a=Number(o),n=Z(),w=ie(),[t,u]=s.useState(0),[f,h]=s.useState(0),[b,c]=s.useState(0),[N,m]=s.useState(0),[g,d]=s.useState(!1),[p,x]=s.useState(!1),{data:y,isLoading:R,error:L}=Q({queryKey:["tetelQuestions",a],queryFn:()=>te({tetelId:a,page:1,limit:1e3}),enabled:!isNaN(a)&&a>0,staleTime:1e3*60*5,retry:2}),i=y?.data??[],T=t===i.length-1,E=me(()=>{t<i.length-1?(u(l=>l+1),d(!1)):(x(!0),r(!1)),t==i.length-1&&r(!1)},100,{leading:!0,trailing:!1}),{timerEnabled:q,setTimerEnabled:r,timerDuration:v,setTimerDuration:V,timeLeft:P,setTimeLeft:C}=le(E);s.useEffect(()=>{if(t===i.length-1){const l=setTimeout(()=>{r(!1),x(!0)},v*1e3);return()=>clearTimeout(l)}},[t,i.length,r]);const{data:z,isLoading:U,error:D}=Q({queryKey:["multiQuestionDetails",y?.data[t]?.id],queryFn:()=>ae(y.data[t].id),enabled:!!y?.data[t]?.id&&!p&&!(T&&!g&&P===0),staleTime:1e3*60*5,retry:2}),G=s.useCallback(l=>{g||(c(j=>j+1),l?(h(j=>j+1),m(j=>j+1)):m(0),d(!0),T&&(x(!0),r(!1)))},[g,T,c,h,m,x,r]),K=s.useCallback(()=>{u(0),h(0),c(0),m(0),d(!1),C(v),x(!1),r(!0)},[v,r,C]),M=s.useCallback(()=>{x(!1),n({to:"/tetelek/$id/questions",params:{id:a.toString()}})},[n,a]);return w?R?e.jsx("div",{className:"p-10 text-center",children:e.jsx(A,{})}):L||D?e.jsxs("div",{className:"p-10 text-center text-red-500",children:["Error: ",(L||D)?.message]}):i.length===0?e.jsx("div",{className:"p-10 text-center text-muted-foreground",children:"No questions available for this tetel."}):e.jsx(s.Suspense,{fallback:e.jsx(A,{}),children:e.jsx(re,{children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1 px-4",children:[e.jsxs(_,{to:"/tetelek/$id",params:{id:a.toString()},className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors",children:[e.jsx(I,{className:"mr-2"}),"Vissza"]}),e.jsxs("div",{className:"text-foreground bg-secondary px-2 rounded-md text-md font-medium",children:[e.jsx("span",{className:"text-primary font-bold",children:t+1})," ","/ ",i.length]})]}),e.jsxs("main",{className:"flex flex-col items-center justify-center max-w-4xl mx-auto p-4 text-center",children:[e.jsx("p",{className:"mb-6 text-secondary-foreground",children:"Csak egy válaszlehetőség jó!"}),e.jsx(ue,{score:f,questionsAnswered:b,streak:N}),e.jsx(k,{as:s.Fragment,show:!!z,enter:"transition ease-out duration-500 transform",enterFrom:"opacity-0 translate-x-4",enterTo:"opacity-100 translate-x-0",children:e.jsxs("div",{className:"flex flex-col items-center gap-6 w-full max-w-2xl",children:[e.jsxs("div",{className:"p-6 rounded-lg bg-secondary text-foreground w-full shadow-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:z?.question}),U?e.jsx("div",{className:"flex justify-center items-center min-h-[200px]",children:e.jsx(ee,{className:"animate-spin text-primary text-5xl"})}):e.jsx(de,{answers:z?.answers??[],onPick:G})]}),e.jsx(oe,{onNext:E,timerEnabled:q,setTimerEnabled:r,timerDuration:v,setTimerDuration:l=>{V(l),C(l)}}),q&&!p&&e.jsxs("div",{className:"fixed text-foreground top-20 md:right-5.5 right-4.5 px-3 rounded-md w-16 bg-secondary shadow-lg mt-4 flex gap-1",children:[e.jsx("span",{className:"text-rose-400 text-right font-mono text-md font-bold",children:P}),"sec"]}),e.jsxs("button",{className:"px-2 py-2 rounded-md mb-10 bg-red-600 hover:bg-red-700 hover:cursor-pointer text-white transition-all flex items-center gap-2",onClick:K,children:[e.jsx(se,{}),"Újrakezdés"]})]})}),e.jsx(xe,{isOpen:p,score:f,total:i.length,onClose:M})]})]})})}):e.jsx(ne,{})}export{we as T};
