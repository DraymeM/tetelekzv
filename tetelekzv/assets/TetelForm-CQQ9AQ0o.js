const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MarkdownHandler-DwK-e7xr.js","assets/index-CHOBRNO2.js","assets/index-Cr4-NZrg.css","assets/FlashCard-D49W5G5Z.js","assets/InputField-LFxcE_CH.js","assets/FormContainer-3aKEaWuq.js","assets/SubmitButton-D72ZWoqY.js"])))=>i.map(i=>d[i]);
import{j as e,r as b,R as E,S as Y,_ as C,aW as W,e as M,v as le,aZ as ue,y as G}from"./index-CHOBRNO2.js";import{o as A,a as D,s as N,p as me,n as he}from"./types-CZYGTQuY.js";import B from"./InputField-LFxcE_CH.js";import{P as ee}from"./PageTransition-RF5KUwbh.js";import{H as se}from"./index-BHf0Kwm1.js";const U=me(s=>s!==void 0?Number(s):void 0,he()).optional(),pe=A({id:U,title:N().min(1,"A cím nem lehet üres!"),description:N()}),xe=A({id:U,content:N().min(1,"A szekció tartalma nem lehet üres!"),subsections:D(pe).nullable().transform(s=>s||[])}),be=A({id:U,question:N().min(1,"Üresen ne hagyd, zárd be ha nem akarsz."),answer:N().min(1,"Üresen ne hagyd, zárd be ha nem akarsz.")}),Q=A({name:N().min(1,"Tétel cím megadása kötelező!"),osszegzes:N().min(1,"Összegzés megadása kötelező!"),sections:D(xe).min(1,"Legalább egy szekció legyen!"),flashcards:D(be).nullable().transform(s=>s||[])}),O=E.lazy(()=>C(()=>import("./MarkdownHandler-DwK-e7xr.js").then(s=>s.M),__vite__mapDeps([0,1,2]))),je=E.lazy(()=>C(()=>import("./FlashCard-D49W5G5Z.js"),__vite__mapDeps([3,1,2])));function fe({data:s}){return e.jsx(b.Suspense,{fallback:e.jsx(Y,{}),children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-center",children:s.name}),s.sections.map(t=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow transition-colors hover:border-border border border-transparent",children:[e.jsx("div",{className:"text-xl font-semibold mb-4",children:e.jsx(O,{content:t.content})}),t.subsections.map(r=>e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium mb-2",children:e.jsx(O,{content:r.title})}),e.jsx("div",{className:"prose prose-invert",children:e.jsx(O,{content:r.description})})]},r.id))]},t.id)),s.osszegzes&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow transition-colors hover:border-border border border-transparent",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Összegzés"}),e.jsx("div",{className:"whitespace-pre-wrap prose prose-invert",children:e.jsx(O,{content:s.osszegzes})})]}),s.flashcards.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Flashcards"}),e.jsx("div",{className:"flex  ml-5 md:ml-15 mr-5 flex-wrap gap-2",children:s.flashcards.map(t=>e.jsx(je,{question:t.question,answer:t.answer},t.id))})]})]})})}const J=({label:s,value:t,onChange:r,error:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:s}),e.jsx("textarea",{rows:4,className:`w-full p-2 rounded bg-secondary text-foreground focus:outline-none focus:ring-2 focus:ring-primary ${i?"border border-red-500":"border border-border"}`,value:t,onChange:r}),i&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i})]}),ve=({name:s,handleNameChange:t,osszegzes:r,handleOsszegzesChange:i,errorName:l,errorOsszegzes:f})=>e.jsxs("div",{children:[e.jsx(B,{label:"Tétel címe",value:s,onChange:t,error:l}),e.jsx(J,{label:"Összegzés",value:r,onChange:i,error:f})]}),ge=E.lazy(()=>C(()=>import("./InputField-LFxcE_CH.js"),__vite__mapDeps([4,1,2]))),ze=({subsection:s,onUpdate:t,onRemove:r,errors:i={}})=>e.jsx(b.Suspense,{children:e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:r,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx(ge,{label:"Cím",value:s.title,onChange:l=>t("title",l.target.value),error:i.title}),e.jsx(J,{label:"Leírás",value:s.description,onChange:l=>t("description",l.target.value),error:i.description})]})}),Se=({onUpdateContent:s,onAddSubsection:t,onRemoveSection:r,onUpdateSubsection:i,onRemoveSubsection:l,section:f,errors:p={}})=>e.jsx(b.Suspense,{children:e.jsxs("div",{className:"p-4 border rounded-lg border-border relative group",children:[e.jsx("button",{type:"button",onClick:r,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx(J,{label:"Szekció tartalma",value:f.content,onChange:d=>s(d.target.value),error:p.content}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-foreground",children:"Alszekciók"}),f.subsections.map((d,u)=>e.jsx(ze,{subsection:d,onRemove:()=>l(u),onUpdate:(o,a)=>i(u,o,a),errors:{title:p[`subsections.${u}.title`],description:p[`subsections.${u}.description`]}},u)),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:t,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(M,{size:15})}),e.jsx("span",{children:"Új Alszekció"})]})]})]})}),Ne=({sections:s,openSections:t,setOpenSections:r,addSection:i,removeSection:l,updateSection:f,addSub:p,updateSub:d,removeSub:u,fieldErrors:o,showSectionErrors:a})=>e.jsxs("div",{className:"space-y-4",children:[s.map((n,c)=>{const v=t[n.id],x={};return Object.entries(o).forEach(([j,z])=>{j.startsWith(`sections.${c}.`)&&(x[j.replace(`sections.${c}.`,"")]=z)}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"w-full flex justify-between p-4 bg-secondary rounded-md hover:cursor-pointer",onClick:()=>r({...t,[n.id]:!v}),children:[e.jsxs("span",{className:"font-medium",children:["Szekció #",c+1]}),e.jsx(se,{className:`transform transition-transform duration-300 ${v?"rotate-180":"rotate-0"}`,size:30})]}),e.jsx(ee,{show:v,children:e.jsx("div",{className:"p-4 border border-border rounded-b-md",children:e.jsx(Se,{index:c,section:n,onUpdateContent:j=>f(n.id,j),onAddSubsection:()=>p(n.id),onRemoveSection:()=>l(n.id),onUpdateSubsection:(j,z,R)=>d(n.id,j,z,R),onRemoveSubsection:j=>u(n.id,j),errors:a?x:{}})})})]},n.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:i,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 hover:cursor-pointer",children:e.jsx(M,{size:15})}),e.jsx("span",{children:"Új Szekció"})]})]}),ye=({flashcard:s,onUpdate:t,onRemove:r,errors:i={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:r,className:"absolute -top-3 -right-3 text-red-500 bg-secondary rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(W,{className:"w-5 h-5"})}),e.jsx("hr",{className:"border-t-2 border-border w-full my-2"}),e.jsx(B,{label:"Kérdés",value:s.question,onChange:l=>t("question",l.target.value),error:i.question}),e.jsx(B,{label:"Válasz",value:s.answer,onChange:l=>t("answer",l.target.value),error:i.answer})]}),we=({flashcards:s,openFlashcards:t,setOpenFlashcards:r,addFlashcard:i,removeFlashcard:l,updateFlashcard:f,fieldErrors:p,showFlashcardErrors:d})=>e.jsxs("div",{className:"space-y-4 mt-6",children:[s.map((u,o)=>{const a=t[u.id],n={};return Object.entries(p).forEach(([c,v])=>{c.startsWith(`flashcards.${o}.`)&&(n[c.replace(`flashcards.${o}.`,"")]=v)}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"w-full flex justify-between p-4 bg-secondary rounded-md hover:cursor-pointer",onClick:()=>r({...t,[u.id]:!a}),children:[e.jsxs("span",{className:"font-medium",children:["Flashcard #",o+1]}),e.jsx(se,{className:`transform transition-transform duration-300 ${a?"rotate-180":"rotate-0"}`,size:30})]}),e.jsx(ee,{show:a,children:e.jsx("div",{className:"p-4 border border-secondary rounded-b-md",children:e.jsx(ye,{flashcard:u,onUpdate:(c,v)=>f(u.id,c,v),onRemove:()=>l(u.id),errors:d?n:{}})})})]},u.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:i,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 hover:cursor-pointer",children:e.jsx(M,{size:15})}),e.jsx("span",{children:"Új flashcard"})]})]});let H=Date.now();function V(s){return s&&s.id!=null?s:{id:++H,content:s?.content??"",subsections:s?.subsections?.map(t=>({id:++H,title:t.title,description:t.description}))??[]}}function ke(s){const[t,r]=b.useState(s?.map(V)??[V()]);return{sections:t,addSection:()=>{const o=V();return r(a=>[...a,o]),o},removeSection:o=>r(a=>a.filter(n=>n.id!==o)),updateSection:(o,a)=>r(n=>n.map(c=>c.id===o?{...c,content:a}:c)),addSub:o=>r(a=>a.map(n=>n.id===o?{...n,subsections:[...n.subsections,{id:++H,title:"",description:""}]}:n)),updateSub:(o,a,n,c)=>r(v=>v.map(x=>x.id===o?{...x,subsections:x.subsections.map((j,z)=>z===a?{...j,[n]:c}:j)}:x)),removeSub:(o,a)=>r(n=>n.map(c=>c.id===o?{...c,subsections:c.subsections.filter((v,x)=>x!==a)}:c))}}let Fe=Date.now();function X(s){return s&&s.id!=null?s:{id:++Fe,question:s?.question??"",answer:s?.answer??""}}function _e(s){const[t,r]=b.useState(s?.map(X)??[]);return{flashcards:t,addFlashcard:()=>{const p=X();return r(d=>[...d,p]),p},updateFlashcard:(p,d,u)=>r(o=>o.map(a=>a.id===p?{...a,[d]:u}:a)),removeFlashcard:p=>r(d=>d.filter(u=>u.id!==p))}}const Ee=E.lazy(()=>C(()=>import("./FormContainer-3aKEaWuq.js"),__vite__mapDeps([5,1,2]))),Ce=E.lazy(()=>C(()=>import("./SubmitButton-D72ZWoqY.js"),__vite__mapDeps([6,1,2])));function $e({initialData:s,onSubmit:t,isPending:r,error:i,success:l,label:f,submitLabel:p}){const{sections:d,addSection:u,removeSection:o,updateSection:a,addSub:n,updateSub:c,removeSub:v}=ke(s?.sections),{flashcards:x,addFlashcard:j,updateFlashcard:z,removeFlashcard:R}=_e(s?.flashcards),[w,te]=b.useState(s?.name||""),[k,re]=b.useState(s?.osszegzes||""),[T,K]=b.useState({}),[P,$]=b.useState({}),[ne,I]=b.useState(()=>d.reduce((m,h,S)=>({...m,[h.id]:S===0}),{})),[ae,L]=b.useState(()=>x.reduce((m,h)=>({...m,[h.id]:!1}),{})),[q,oe]=b.useState(!1);b.useEffect(()=>{const m=Q.safeParse({name:w,osszegzes:k,sections:d,flashcards:x});if(m.success)K({});else{const h={};m.error.errors.forEach(S=>{h[S.path.join(".")]=S.message}),K(h)}},[w,k,d,x]),b.useEffect(()=>{(i||l)&&window.scrollTo({top:0,behavior:"smooth"})},[i,l]);const ie=m=>{m.preventDefault(),$({name:!0,osszegzes:!0,sections:!0,flashcards:!0});const h=Q.safeParse({name:w,osszegzes:k,sections:d,flashcards:x});if(!h.success){G.error("Javítsd ki a hibákat mielőtt mentenél!");const S=new Set,Z=new Set;h.error.errors.forEach(F=>{const[g,y]=F.path;if(g==="sections"){const _=d[y]?.id;_!=null&&S.add(_)}if(g==="flashcards"){const _=x[y]?.id;_!=null&&Z.add(_)}}),I(F=>{const g={...F};return S.forEach(y=>g[y]=!0),g}),L(F=>{const g={...F};return Z.forEach(y=>g[y]=!0),g});return}t(h.data),G.success("Sikeres mentés!")},de=()=>{const m=u();I(h=>({...h,[m.id]:!0}))},ce=()=>{const m=j();L(h=>({...h,[m.id]:!0}))};return e.jsx("div",{children:e.jsx(b.Suspense,{fallback:e.jsx(Y,{}),children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>oe(m=>!m),className:"fixed bottom-7 right-7 p-3 bg-purple-600 text-white rounded-full hover:bg-purple-700 hover:scale-105 transition-all z-50",title:q?"Vissza szerkesztéshez":"Előnézet",children:q?e.jsx(le,{size:20}):e.jsx(ue,{size:20})})}),e.jsx(Ee,{error:i,success:l,label:f,children:e.jsx("form",{onSubmit:ie,className:"space-y-6",children:q?e.jsx(fe,{data:{name:w,osszegzes:k,sections:d,flashcards:x}}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{name:w,handleNameChange:m=>{te(m.target.value),$(h=>({...h,name:!0}))},osszegzes:k,handleOsszegzesChange:m=>{re(m.target.value),$(h=>({...h,osszegzes:!0}))},errorName:P.name?T.name:void 0,errorOsszegzes:P.osszegzes?T.osszegzes:void 0}),e.jsx(Ne,{sections:d,openSections:ne,setOpenSections:I,addSection:de,removeSection:o,updateSection:a,addSub:n,updateSub:c,removeSub:v,fieldErrors:T,showSectionErrors:P.sections}),e.jsx(we,{flashcards:x,openFlashcards:ae,setOpenFlashcards:L,addFlashcard:ce,removeFlashcard:R,updateFlashcard:z,fieldErrors:T,showFlashcardErrors:P.flashcards}),e.jsx(Ce,{isPending:r,label:p})]})})})]})})})}export{$e as default};
