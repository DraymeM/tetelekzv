const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PlayPauseControls-qc7ukXc9.js","assets/index-DaprCxnA.js","assets/index-BIrAcGUK.css","assets/OfflinePlaceholder-RQFBe3qp.js","assets/VoiceSelector-DltCcAqK.js","assets/SpeechSliders-FLFS0hNh.js","assets/MarkdownHandler-SGc66dZa.js"])))=>i.map(i=>d[i]);
import{r as s,j as e,aC as V,aV as C,aW as D,_ as k,b as I,u as R,f as A,e as L,R as $,y as M,O as B,a as z,g as T,aG as q,aI as Q,aJ as E}from"./index-DaprCxnA.js";import{u as W}from"./useLocation-DPX8H_TL.js";import{u as H}from"./useQuery-CxLIcma_.js";import{u as K}from"./useMutation-BqTQn4ts.js";import{i as U,d as G}from"./repo-Dy-ukzJ_.js";import J from"./DeleteModal-Gkwk_lH4.js";import{P as X}from"./PageTransition-DPo7WQF5.js";import{O as Y}from"./OfflinePlaceholder-RQFBe3qp.js";import{l as P}from"./menu-CQpvV0Tf.js";function Z(){const t=window.speechSynthesis,[d,r]=s.useState([]),[n,u]=s.useState(!1),[x,i]=s.useState(!1),f=s.useRef(null),j=()=>new Promise(m=>{let o=t.getVoices();if(o.length>0)r(o),m(o);else{const c=setInterval(()=>{o=t.getVoices(),o.length>0&&(clearInterval(c),r(o),m(o))},100)}});s.useEffect(()=>(j(),"onvoiceschanged"in t&&(t.onvoiceschanged=j),()=>{"onvoiceschanged"in t&&(t.onvoiceschanged=null)}),[]);const p=(m,o,c=1,w=1,N=1)=>{if(!m)return;h();const a=new SpeechSynthesisUtterance(m);if(o){const y=d.find(l=>l.name===o);y&&(a.voice=y)}a.rate=c,a.pitch=w,a.volume=N,a.onstart=()=>{u(!0),i(!1)},a.onend=()=>{u(!1),i(!1)},a.onerror=()=>{u(!1),i(!1)},f.current=a,t.speak(a)},g=()=>{t.speaking&&!t.paused&&(t.pause(),i(!0))},v=()=>{t.paused&&(t.resume(),i(!1))},h=()=>{t.cancel(),u(!1),i(!1)};return{voices:d,speak:p,pause:g,resume:v,stop:h,isSpeaking:n,isPaused:x}}const ee=()=>{if(typeof window>"u")return!1;const t=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone;return/Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile/i.test(navigator.userAgent)||t},te=s.lazy(()=>k(()=>import("./PlayPauseControls-qc7ukXc9.js"),__vite__mapDeps([0,1,2,3]))),se=s.lazy(()=>k(()=>import("./VoiceSelector-DltCcAqK.js"),__vite__mapDeps([4,1,2]))),ne=s.lazy(()=>k(()=>import("./SpeechSliders-FLFS0hNh.js"),__vite__mapDeps([5,1,2]))),ae=({text:t,className:d})=>{if(typeof window<"u"&&ee())return null;const{voices:r,speak:n,pause:u,resume:x,stop:i,isSpeaking:f,isPaused:j}=Z(),[p,g]=s.useState(),[v,h]=s.useState(1),[m,o]=s.useState(1),[c,w]=s.useState(1),[N,a]=s.useState(!1),[y,l]=s.useState("");s.useEffect(()=>{r.length>0&&!p&&g(r[0].name)},[r,p]),s.useEffect(()=>()=>window.speechSynthesis.cancel(),[]);const b=()=>{!t||r.length===0||(f?j?x():u():n(t,p,v,m,c))},F=S=>{g(S),a(!1),f&&i()},O=(S,_)=>{S==="rate"&&h(_),S==="pitch"&&o(_),S==="volume"&&w(_),f&&i()};return e.jsx(P,{as:"div",className:`relative inline-block text-left ${d??""}`,children:({open:S})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-0",children:[e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(V,{className:"animate-spin text-primary text-3xl"})}),children:e.jsx(te,{isSpeaking:f,isPaused:j,hasVoices:r.length>0,onClick:b})}),e.jsx(P.Button,{className:"inline-flex items-center px-2 py-2.5 bg-blue-600 border-l-2 border-blue-800 hover:cursor-pointer rounded-r-md text-sm font-medium text-white hover:bg-blue-700","aria-label":"Felolvasási Beállítások",title:"Felolvasási Beállítások",children:e.jsx(C,{size:16,className:`transition-transform duration-300 ${S?"rotate-180":"rotate-0"}`})})]}),e.jsx(P.Items,{className:"absolute right-0 mt-2 w-64 bg-secondary border border-border rounded-md shadow-lg p-4 space-y-4 max-h-[400px] overflow-auto z-50",children:e.jsxs(s.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(V,{className:"animate-spin text-primary min-h-[300px] max-w-[50px] text-4xl"})}),children:[e.jsx(se,{voices:r,selectedVoice:p,isDropdownOpen:N,setDropdownOpen:a,searchTerm:y,setSearchTerm:l,handleVoiceChange:F}),e.jsx(ne,{rate:v,pitch:m,volume:c,onChange:O}),e.jsx("div",{className:"flex justify-between mt-2",children:e.jsxs("button",{onClick:i,disabled:!f,className:`inline-flex items-center px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition ${f?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(D,{}),e.jsx("span",{className:"ml-2",children:"Stop"})]})})]})})]})})};function re(t,d){const r=x=>x.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim();let n="";t.forEach(x=>{n+=" "+r(x.content),x.subsections?.forEach(i=>{n+=" "+r(i.title||""),n+=" "+r(i.description||"")})}),d?.content&&(n+=" "+r(d.content));const u=n.split(" ").filter(Boolean).length;return Math.ceil(u/200)}function pe(){const{isAuthenticated:t,isSuperUser:d}=I(),{id:r}=R({strict:!1}),n=Number(r),u=W(),x=A(),i=L(),f=u.pathname.includes("/edit"),[j,p]=s.useState(!1),{data:g,error:v}=H({queryKey:["tetelDetail",n],queryFn:()=>G(n),enabled:!isNaN(n)&&n>0,retry:2,refetchOnWindowFocus:!1});s.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[u.pathname]);const h=$.lazy(()=>k(()=>import("./MarkdownHandler-SGc66dZa.js").then(l=>l.M),__vite__mapDeps([6,1,2]))),m=K({mutationFn:()=>{if(!t||!d)throw M.error("Nincs engedélyed a művelethez"),new Error("Nincs engedélyed a művelethez");return U(n)},onSuccess:()=>{i.invalidateQueries({queryKey:["tetelek"]}),M.success("Sikeresen törölted a tételt."),x({to:"/tetelek"})}});if(v)return navigator.onLine?e.jsxs("div",{className:"p-10 text-red-500 text-center",children:["Hiba történt: ",v.message]}):e.jsx(Y,{});if(f)return e.jsx(B,{});const o=g?.tetel??{name:"Ismeretlen tétel"},c=g?.osszegzes,w=g?.sections??[],N=re(w,c),a=l=>l.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim(),y=[a(o.name),...w.flatMap(l=>[a(l.content),...l.subsections?.flatMap(b=>[a(b.title||""),a(b.description||"")])??[]]),"Összegzés:",c?.content?a(c.content):"","Vége"].filter(Boolean).join(". ");return e.jsx(s.Suspense,{children:e.jsxs("main",{className:"relative md:max-w-7xl max-w-full mx-auto mt-10 md:px-10 px-3 pt-10 pb-1 text-left",children:[e.jsxs(X,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs(z,{to:"/tetelek/$id",params:{id:n.toString()},className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tétel áttekintéséhez",title:"Vissza a tételhez",children:[e.jsx(T,{className:"mr-2","aria-hidden":"true"}),"Vissza"]}),e.jsxs("div",{className:"flex items-center md:gap-4 gap-1",children:[e.jsxs("span",{className:"text-sm mx-auto text-secondary-foreground",children:[e.jsx(q,{className:"inline mr-1",size:15,"aria-hidden":"true"}),N," perc"]}),e.jsx(ae,{text:y})]})]}),e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-foreground",children:o.name}),e.jsxs("div",{className:"space-y-6",children:[w.map(l=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow-xl border border-transparent hover:border-border transition-colors",children:[e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-secondary rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsx("div",{className:"text-xl font-semibold mb-4 text-foreground",children:e.jsx(h,{content:l.content})})}),l.subsections?.map(b=>e.jsx(s.Suspense,{fallback:e.jsx("div",{className:"bg-muted rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium text-foreground mb-2",children:e.jsx(h,{content:b.title})}),e.jsx("div",{className:"text-secondary-foreground prose prose-invert max-w-none",children:e.jsx(h,{content:b.description})})]})},b.id))]},l.id)),c?.content&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 border border-transparent hover:border-border transition-colors",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-foreground",children:"Összegzés"}),e.jsx("div",{className:"text-foreground prose prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(h,{content:c.content})})]}),e.jsxs(z,{to:"/tetelek/$id",params:{id:n.toString()},className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tétel áttekintéséhez",title:"Vissza a tételhez",children:[e.jsx(T,{className:"mr-2","aria-hidden":"true"}),"Vissza"]})]}),e.jsx(J,{isOpen:j,onClose:()=>p(!1),onDelete:()=>m.mutate(),isDeleting:m.isPending,itemName:o.name})]}),t&&d?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>p(!0),className:"fixed bottom-7 right-7 p-3 bg-rose-600 text-white rounded-full hover:bg-rose-700 hover:cursor-pointer transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Töröld a tételt","aria-label":"Töröld a tételt",children:e.jsx(Q,{size:20,"aria-hidden":"true"})}),e.jsx(z,{to:"/tetelek/$id/details/edit",params:{id:n.toString()},className:"fixed bottom-22 right-7 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(E,{size:20,"aria-hidden":"true"})})]}):t?e.jsx(z,{to:"/tetelek/$id/details/edit",params:{id:n.toString()},className:"fixed bottom-7 right-7 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(E,{size:20,"aria-hidden":"true"})}):null]})})}export{pe as T};
