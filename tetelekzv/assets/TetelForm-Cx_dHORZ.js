import{j as e,C as E,b as F,r as p,N as H,y as $}from"./index-Bk802S-e.js";import{z as a,F as I,S as M}from"./SubmitButton-BauQyqke.js";import{I as k}from"./InputField-DWA0OCfH.js";const A=a.preprocess(t=>t!==void 0?Number(t):void 0,a.number()).optional(),Q=a.object({id:A,title:a.string().min(1,"A cím nem lehet üres!"),description:a.string()}),X=a.object({id:A,content:a.string().min(1,"A szekció tartalma nem lehet üres!"),subsections:a.array(Q).nullable().transform(t=>t||[])}),Y=a.object({id:A,question:a.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz."),answer:a.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz.")}),q=a.object({name:a.string().min(1,"Tétel cím megadása kötelező!"),osszegzes:a.string().min(1,"Összegzés megadása kötelező!"),sections:a.array(X).min(1,"Legalább egy szekció legyen!"),flashcards:a.array(Y).nullable().transform(t=>t||[])}),R=({label:t,value:d,onChange:m,error:l})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:t}),e.jsx("textarea",{rows:4,className:`w-full p-2 rounded bg-secondary text-foreground focus:outline-none focus:ring-2 focus:ring-primary ${l?"border border-red-500":"border border-border"}`,value:d,onChange:m}),l&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l})]}),Z=({subsection:t,onUpdate:d,onRemove:m,errors:l={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:m,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(k,{label:"Cím",value:t.title,onChange:i=>d("title",i.target.value),error:l.title}),e.jsx(R,{label:"Leírás",value:t.description,onChange:i=>d("description",i.target.value),error:l.description})]}),D=({onUpdateContent:t,onAddSubsection:d,onRemoveSection:m,onUpdateSubsection:l,onRemoveSubsection:i,section:z,errors:v={}})=>e.jsxs("div",{className:"p-4 border rounded-lg border-border relative group",children:[e.jsx("button",{type:"button",onClick:m,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(R,{label:"Szekció tartalma",value:z.content,onChange:h=>t(h.target.value),error:v.content}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-foreground",children:"Alszekciók"}),z.subsections.map((h,b)=>e.jsx(Z,{subsection:h,onRemove:()=>i(b),onUpdate:(g,y)=>l(b,g,y),errors:{title:v[`subsections.${b}.title`],description:v[`subsections.${b}.description`]}},b)),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:d,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Alszekció"})]})]})]}),ee=({flashcard:t,onUpdate:d,onRemove:m,errors:l={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:m,className:"absolute -top-3 -right-3 text-red-500 bg-secondary rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx("hr",{className:"border-t-2 border-border w-full my-2"}),e.jsx(k,{label:"Kérdés",value:t.question,onChange:i=>d("question",i.target.value),error:l.question}),e.jsx(k,{label:"Válasz",value:t.answer,onChange:i=>d("answer",i.target.value),error:l.answer})]}),oe=({initialData:t,onSubmit:d,isPending:m,error:l,success:i,label:z,submitLabel:v})=>{const[h,b]=p.useState((t==null?void 0:t.name)||""),[g,y]=p.useState((t==null?void 0:t.osszegzes)||""),[u,j]=p.useState((t==null?void 0:t.sections)||[{content:"",subsections:[]}]),[x,w]=p.useState((t==null?void 0:t.flashcards)||[]),[S,T]=p.useState({}),[f,C]=p.useState({});p.useEffect(()=>{const s=q.safeParse({name:h,osszegzes:g,sections:u,flashcards:x});if(s.success)T({});else{const r={};s.error.errors.forEach(o=>{r[o.path.join(".")]=o.message}),T(r)}},[h,g,u,x]);const U=s=>{s.preventDefault(),C({name:!0,osszegzes:!0,sections:!0,flashcards:!0});const r=q.safeParse({name:h,osszegzes:g,sections:u,flashcards:x});if(!r.success){$.error("Javítsd ki a hibákat mielőtt mentenél!");return}d(r.data),$.success("Sikeres mentés!")},B=()=>{j([...u,{id:Date.now()*-1,content:"",subsections:[]}])},O=s=>{j(u.filter(r=>r.id!==s))},P=(s,r)=>{j(u.map(o=>o.id===s?{...o,content:r}:o))},L=s=>{j(u.map(r=>r.id===s?{...r,subsections:[...r.subsections,{id:Date.now()*-1,title:"",description:""}]}:r))},W=(s,r,o,n)=>{j(u.map(c=>c.id===s?{...c,subsections:c.subsections.map((N,G)=>G===r?{...N,[o]:n}:N)}:c))},J=(s,r)=>{j(u.map(o=>o.id===s?{...o,subsections:o.subsections.filter((n,c)=>c!==r)}:o))},K=()=>{w([...x,{id:Date.now()*-1,question:"",answer:""}])},V=(s,r,o)=>{w(x.map(n=>n.id===s?{...n,[r]:o}:n))},_=s=>{w(x.filter(r=>r.id!==s))};return e.jsxs("div",{children:[e.jsx(H,{}),e.jsx("div",{className:"max-w-6xl mx-auto items-center",children:e.jsx(I,{error:l,success:i,label:z,children:e.jsxs("form",{onSubmit:U,className:"space-y-6",children:[e.jsx(k,{label:"Tétel címe",value:h,onChange:s=>{b(s.target.value),C({...f,name:!0})},error:f.name?S.name:void 0}),e.jsx(R,{label:"Összegzés",value:g,onChange:s=>{y(s.target.value),C({...f,osszegzes:!0})},error:f.osszegzes?S.osszegzes:void 0}),u.map((s,r)=>{const o={};return Object.entries(S).forEach(([n,c])=>{n.startsWith(`sections.${r}.`)&&(o[n.replace(`sections.${r}.`,"")]=c)}),e.jsx(D,{index:s.id,section:s,onUpdateContent:n=>P(s.id,n),onAddSubsection:()=>L(s.id),onRemoveSection:()=>O(s.id),onUpdateSubsection:(n,c,N)=>W(s.id,n,c,N),onRemoveSubsection:n=>J(s.id,n),errors:f.sections?o:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:B,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Szekció"})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h4",{className:"text-md font-medium text-foreground",children:"FlashCard"})}),x.map((s,r)=>{const o={};return Object.entries(S).forEach(([n,c])=>{n.startsWith(`flashcards.${r}.`)&&(o[n.replace(`flashcards.${r}.`,"")]=c)}),e.jsx(ee,{flashcard:s,onUpdate:(n,c)=>V(s.id,n,c),onRemove:()=>_(s.id),errors:f.flashcards?o:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:K,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új flashcard"})]}),e.jsx(M,{isPending:m,label:v})]})})})]})};export{oe as T};
