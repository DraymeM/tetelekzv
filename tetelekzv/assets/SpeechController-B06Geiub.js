const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/VoiceSelector-hwDPMHKf.js","assets/index-KVBsG1ou.js","assets/index-DCi6IH1O.css","assets/SpeechSliders-LROpaq2z.js","assets/index.module-dWCCZxIv.js"])))=>i.map(i=>d[i]);
import{r as t,j as e,bc as Y,bd as Z,be as ee,z as te,aE as se,bf as re,aC as ne,_ as q}from"./index-KVBsG1ou.js";import{M as oe}from"./OfflinePlaceholder-BS0FVtr2.js";import{a as ae,b as ie}from"./index-BjEfbLHr.js";import{l as A}from"./menu-DSpSgCyB.js";import"./use-resolve-button-type-DnbLG9Do.js";import"./bugs-B7WK9xZh.js";import"./label-CizLqlf9.js";function ce(){const s=t.useRef(null),[x,d]=t.useState([]),[k,y]=t.useState(!1),[z,f]=t.useState(!1),[u,g]=t.useState(!0),[_,h]=t.useState(null),E=t.useRef([]),[C,l]=t.useState(0),[w,I]=t.useState([]),V=t.useRef(!0),v=t.useRef(void 0),F=t.useRef({rate:1,pitch:1,volume:1}),p=typeof window<"u"&&"speechSynthesis"in window;t.useEffect(()=>{if(V.current=!0,!p){g(!1),h("Speech synthesis is not supported by your browser.");return}s.current=window.speechSynthesis;const r=()=>{const o=s.current.getVoices();o.length>0?(d(o),g(!1),h(null)):setTimeout(r,1500)};return g(!0),r(),s.current.onvoiceschanged=r,()=>{V.current=!1,P(),s.current&&(s.current.onvoiceschanged=null)}},[p]);const O=(r,o)=>{const m=[];let a=0;for(;a<r.length;){let i=a+o;if(i<r.length){for(;i>a&&r[i]!==" ";)i--;i===a&&(i=a+o)}else i=r.length;const c=r.slice(a,i).trim();for(c.length>0&&m.push(c),a=i;a<r.length&&r[a]===" ";)a++}return m},M=(r,o,m=1,a=1,i=1)=>{const c=new SpeechSynthesisUtterance(r),R=o?x.find(S=>S.name===o):x[0];return R&&(c.voice=R),c.rate=Math.min(Math.max(m,.1),10),c.pitch=Math.min(Math.max(a,0),2),c.volume=Math.min(Math.max(i,0),1),c.onerror=S=>{h(`Speech Error: ${S.error}`),y(!1),f(!1)},c},D=(r,o,m=1,a=1,i=1,c=0)=>{if(!r||!p||!s.current||u){h("Cannot speak: Voices are still loading or not supported.");return}P(),v.current=o,F.current={rate:m,pitch:a,volume:i};const R=r.trim().replace(/\s+/g," "),S=O(R,300);I(S),l(c);const j=S.slice(c).map((T,$)=>{const N=M(T,o,m,a,i);return N.onstart=()=>{l(c+$),y(!0),f(!1)},N.onend=()=>{$===S.length-c-1&&(y(!1),f(!1),l(S.length-1))},N});E.current=j,j.forEach(T=>s.current.speak(T))},U=r=>{if(r<0||r>=w.length||!s.current)return;P();const{rate:o,pitch:m,volume:a}=F.current;D(w.join(" "),v.current,o,m,a,r)},P=()=>{!p||!s.current||(s.current.cancel(),y(!1),f(!1),h(null),E.current=[])};return{voices:x,speak:D,pause:()=>{!p||!s.current||!k||z||(s.current.pause(),f(!0))},resume:()=>{!p||!s.current||!k||!z||(s.current.resume(),f(!1))},stop:P,isSpeaking:k,isPaused:z,isSupported:p,isLoadingVoices:u,error:_,chunks:w,currentChunkIndex:C,goToChunk:U}}const le=t.lazy(()=>q(()=>import("./VoiceSelector-hwDPMHKf.js"),__vite__mapDeps([0,1,2]))),ue=t.lazy(()=>q(()=>import("./SpeechSliders-LROpaq2z.js"),__vite__mapDeps([3,1,2,4]))),Q=(s,x)=>s.trim().split(/\s+/).length/3/x,W=s=>{const x=Math.floor(s/60),d=Math.floor(s%60);return`${String(x).padStart(2,"0")}:${String(d).padStart(2,"0")}`},be=({text:s,className:x})=>{const{voices:d,speak:k,pause:y,resume:z,stop:f,isSpeaking:u,isPaused:g,isSupported:_,isLoadingVoices:h,error:E,chunks:C,currentChunkIndex:l,goToChunk:w}=ce(),[I,V]=t.useState(),[v,F]=t.useState(1),[p,O]=t.useState(1),[M,D]=t.useState(1),[U,P]=t.useState(!1),[B,X]=t.useState(""),[r,o]=t.useState(!1),[m,a]=t.useState(!1);t.useEffect(()=>{if(h||d.length===0)return;const n=localStorage.getItem("selectedVoice");if(n&&d.some(b=>b.name===n))V(n);else{const b=d.find(L=>L.localService)||d[0];V(b?.name),n&&n!==b?.name&&console.warn(`Stored voice "${n}" not found, using default.`)}},[d,h]),t.useEffect(()=>()=>f(),[]),t.useEffect(()=>{!u&&!g&&r&&l>=C.length-1&&o(!1)},[u,g,r,l,C.length]);const i=()=>{!s||d.length===0||h||(u?g?z():y():(k(s,I,v,p,M),o(!0)))},c=()=>{f(),o(!1)},R=n=>{V(n),n?localStorage.setItem("selectedVoice",n):localStorage.removeItem("selectedVoice"),u&&(f(),k(s,n,v,p,M,l),o(!0))},S=(n,b)=>{n==="rate"&&F(b),n==="pitch"&&O(b),n==="volume"&&D(b),u&&(f(),k(s,I,v,p,M,l),o(!0))},j=C.length,T=Q(C.slice(0,l).join(" "),v),$=Q(s,v),N=(n,b)=>{const L=b.getBoundingClientRect(),G=n-L.left,J=Math.min(Math.max(G/L.width,0),1),K=Math.floor(J*j);w(K),o(!0)},H=!u&&l>=j-1?100:l/(j||1)*100;return e.jsxs("div",{className:`relative ${x??""}`,children:[!u&&!r&&e.jsx("button",{onClick:i,disabled:h||!_||d.length===0,className:"inline-flex items-center py-2.5 px-3 hover:cursor-pointer bg-blue-600 border-blue-500 rounded-md text-sm font-medium text-white hover:bg-blue-700 focus:outline-none transition-colors disabled:opacity-50 disabled:cursor-not-allowed","aria-label":"Start Speech",title:"Start Speech",children:e.jsx(oe,{size:18})}),(u||r)&&e.jsxs("div",{className:"fixed bottom-0 left-0 h-13 md:h-max md:left-33 w-[100dvw] md:w-[calc(100vw-8.6rem)] bg-secondary border-t-border py-2 flex justify-center md:gap-10 gap-3 items-center z-50 shadow-lg",children:[e.jsxs("div",{className:"absolute top-0 left-2 md:w-[98%] w-[95%] mr-10 h-1 cursor-pointer bg-border rounded",onClick:n=>N(n.clientX,n.currentTarget),onMouseDown:()=>a(!0),onMouseUp:()=>a(!1),onMouseMove:n=>{m&&N(n.clientX,n.currentTarget)},children:[e.jsx("div",{className:"h-1 bg-primary transition-all duration-300",style:{width:`${H}%`}}),e.jsx("div",{className:"absolute top-[-4px] -translate-x-1/2 w-3 h-3 rounded-full bg-primary text-sm border border-border shadow",style:{left:`${H}%`}})]}),e.jsxs("span",{className:"absolute top-1 text-foreground left-2 md:text-sm text-[11px] font-mono",children:[W(T)," / ",W($)]}),e.jsx("button",{onClick:c,className:"text-foreground hover:cursor-pointer","aria-label":"Stop",title:"Stop",children:e.jsx(Y,{size:18})}),e.jsx("button",{onClick:()=>{w(l-1),o(!0)},disabled:l===0,className:"text-foreground hover:cursor-pointer disabled:opacity-50","aria-label":"Previous Chunk",title:"Previous Chunk",children:e.jsx(ae,{size:18})}),e.jsx("button",{onClick:i,className:"text-white bg-teal-600 rounded-full p-3 mt-1 hover:cursor-pointer hover:bg-teal-700","aria-label":u&&!g?"Pause":"Play",title:u&&!g?"Pause":"Play",children:u&&!g?e.jsx(Z,{size:18}):e.jsx(ee,{size:18})}),e.jsx("button",{onClick:()=>{w(l+1),o(!0)},disabled:l>=j-1,className:"text-foreground hover:cursor-pointer disabled:opacity-50","aria-label":"Next Chunk",title:"Next Chunk",children:e.jsx(ie,{size:18})}),e.jsxs(A,{as:"div",className:"relative",children:[e.jsx(A.Button,{className:"text-foreground focus:outline-none hover:cursor-pointer mt-1 transition-colors duration-200","aria-label":"Reading Settings",title:"Reading Settings",disabled:h||!_,children:({open:n})=>e.jsx(te,{show:!0,appear:!0,enter:"transition-opacity duration-200",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"transition-opacity duration-150",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:n?e.jsx(se,{size:18}):e.jsx(re,{size:18})})}),e.jsx(A.Items,{className:"absolute right-1/2 bottom-7 mb-2 w-64 bg-secondary border border-border rounded-md shadow-lg p-4 space-y-4 max-h-[400px] overflow-auto z-50",children:e.jsxs(t.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(ne,{className:"animate-spin text-primary min-h-[310px] max-w-[50px] text-4xl"})}),children:[E&&e.jsx("div",{className:"text-red-600 text-sm mb-2",children:E}),h&&e.jsx("div",{className:"text-muted-foreground text-sm mb-2",children:"Loading voices..."}),e.jsx(le,{voices:d,selectedVoice:I,isDropdownOpen:U,setDropdownOpen:P,searchTerm:B,setSearchTerm:X,handleVoiceChange:R,isLoadingVoices:h}),e.jsx(ue,{rate:v,pitch:p,volume:M,onChange:S})]})})]})]})]})};export{be as default};
