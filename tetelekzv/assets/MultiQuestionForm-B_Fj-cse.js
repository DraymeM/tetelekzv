import{e as K,d as M,r as a,y as v,j as t,N as P,S as z}from"./index-MfXWJZRy.js";import{u as B}from"./useMutation-C8t57buJ.js";import{z as l,F as I,S as L}from"./SubmitButton-DGDexfXE.js";import{a as T}from"./repo-WJTK3AE9.js";import{Q as V,A as D}from"./AnswerInput-OGDAWqdo.js";const R=l.object({text:l.string().min(1,"A válasz szövege nem lehet üres"),isCorrect:l.boolean()}),C=l.object({question:l.string().min(1,"A kérdés megadása kötelező"),answers:l.array(R).length(4,"Pontosan négy válasz szükséges").refine(i=>i.some(c=>c.isCorrect),{message:"Legalább egy válasznak helyesnek kell lennie"})}),W=()=>{const i=K(),c=M(),[o,h]=a.useState(""),[n,p]=a.useState([{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]),[q,u]=a.useState(null),[y,m]=a.useState(null),[g,w]=a.useState({question:void 0,answers:[null,null,null,null]}),[S,f]=a.useState({question:!1,answers:[!1,!1,!1,!1]}),[,b]=a.useState(!1),[E,d]=a.useState(!1),j=B({mutationFn:s=>T(s),onMutate:()=>{d(!0)},onSuccess:()=>{c.invalidateQueries({queryKey:["multiQuestions"]}),h(""),p([{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]),u(null),w({question:void 0,answers:[null,null,null,null]}),f({question:!1,answers:[!1,!1,!1,!1]}),b(!1),v.success("Kérdés létrehozva!"),m("Kérdés létrehozva!"),setTimeout(()=>{m(null),d(!1),i({to:"/mquestions"})},2e3)},onError:s=>{var e,r;v.error("Nem sikerült a kérdés létrehozása!"),u(((r=(e=s.response)==null?void 0:e.data)==null?void 0:r.error)||s.message||"Nem sikerült a kérdés létrehozása"),d(!1)}});a.useEffect(()=>{const s=C.safeParse({question:o,answers:n}),e={question:void 0,answers:[null,null,null,null]};s.success||s.error.errors.forEach(r=>{r.path[0]==="question"?e.question=r.message:r.path[0]==="answers"&&typeof r.path[1]=="number"&&(e.answers[r.path[1]]=r.message)}),w(e)},[o,n]);const N=(s,e,r)=>{const x=[...n];x[s]={...x[s],[e]:r},p(x),f(k=>({...k,answers:k.answers.map((A,F)=>F===s?!0:A)}))},Q=s=>{s.preventDefault(),u(null),m(null),b(!0);const e=C.safeParse({question:o,answers:n});if(!e.success){u(e.error.errors[0].message),f({question:!0,answers:[!0,!0,!0,!0]});return}j.mutate({question:o,answers:n})};return t.jsxs(a.Suspense,{fallback:t.jsx(z,{}),children:[t.jsx(P,{}),E&&t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundColor:"rgba(25, 25, 30, 0.3)"},children:t.jsx(z,{})}),t.jsx("div",{className:"max-w-4xl mx-auto items-center mt-10",children:t.jsx(I,{error:q,success:y,label:"Új Felelet Választós Kérdés",children:t.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[t.jsx(V,{question:o,setQuestion:h,fieldErrors:g,touched:S}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-2",children:"Válaszok"}),n.map((s,e)=>t.jsx(D,{answer:s,index:e,updateAnswer:N,fieldErrors:g.answers[e],touched:S.answers[e]},e))]}),t.jsx(L,{isPending:j.isPending,label:"Kérdés Létrehozása"})]})})})]})};export{W as M};
