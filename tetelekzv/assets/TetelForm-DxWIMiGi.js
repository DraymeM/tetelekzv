import{j as e,C as E,b as F,r as p,N as G,y as T}from"./index-hOu_68pd.js";import{z as a,F as H,S as I}from"./SubmitButton-0gl-AtzO.js";import{I as k}from"./InputField-C8kAHn1T.js";const M=a.object({id:a.number().optional(),title:a.string().min(1,"A cím nem lehet üres!"),description:a.string()}),Q=a.object({id:a.number().optional(),content:a.string().min(1,"A szekció tartalma nem lehet üres!"),subsections:a.array(M).nullable().transform(r=>r||[])}),X=a.object({id:a.number().optional(),question:a.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz."),answer:a.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz.")}),$=a.object({name:a.string().min(1,"Tétel cím megadása kötelező!"),osszegzes:a.string().min(1,"Összegzés megadása kötelező!"),sections:a.array(Q).min(1,"Legalább egy szekció legyen!"),flashcards:a.array(X).nullable().transform(r=>r||[])}),A=({label:r,value:d,onChange:m,error:l})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:r}),e.jsx("textarea",{rows:4,className:`w-full p-2 rounded bg-secondary text-foreground focus:outline-none focus:ring-2 focus:ring-primary ${l?"border border-red-500":"border border-border"}`,value:d,onChange:m}),l&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l})]}),Y=({subsection:r,onUpdate:d,onRemove:m,errors:l={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:m,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(k,{label:"Cím",value:r.title,onChange:i=>d("title",i.target.value),error:l.title}),e.jsx(A,{label:"Leírás",value:r.description,onChange:i=>d("description",i.target.value),error:l.description})]}),Z=({onUpdateContent:r,onAddSubsection:d,onRemoveSection:m,onUpdateSubsection:l,onRemoveSubsection:i,section:z,errors:v={}})=>e.jsxs("div",{className:"p-4 border rounded-lg border-border relative group",children:[e.jsx("button",{type:"button",onClick:m,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(A,{label:"Szekció tartalma",value:z.content,onChange:h=>r(h.target.value),error:v.content}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-foreground",children:"Alszekciók"}),z.subsections.map((h,b)=>e.jsx(Y,{subsection:h,onRemove:()=>i(b),onUpdate:(g,y)=>l(b,g,y),errors:{title:v[`subsections.${b}.title`],description:v[`subsections.${b}.description`]}},b)),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:d,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Alszekció"})]})]})]}),D=({flashcard:r,onUpdate:d,onRemove:m,errors:l={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:m,className:"absolute -top-3 -right-3 text-red-500 bg-secondary rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx("hr",{className:"border-t-2 border-border w-full my-2"}),e.jsx(k,{label:"Kérdés",value:r.question,onChange:i=>d("question",i.target.value),error:l.question}),e.jsx(k,{label:"Válasz",value:r.answer,onChange:i=>d("answer",i.target.value),error:l.answer})]}),re=({initialData:r,onSubmit:d,isPending:m,error:l,success:i,label:z,submitLabel:v})=>{const[h,b]=p.useState((r==null?void 0:r.name)||""),[g,y]=p.useState((r==null?void 0:r.osszegzes)||""),[u,j]=p.useState((r==null?void 0:r.sections)||[{content:"",subsections:[]}]),[x,w]=p.useState((r==null?void 0:r.flashcards)||[]),[S,R]=p.useState({}),[f,C]=p.useState({});p.useEffect(()=>{const s=$.safeParse({name:h,osszegzes:g,sections:u,flashcards:x});if(s.success)R({});else{const t={};s.error.errors.forEach(o=>{t[o.path.join(".")]=o.message}),R(t)}},[h,g,u,x]);const q=s=>{s.preventDefault(),C({name:!0,osszegzes:!0,sections:!0,flashcards:!0});const t=$.safeParse({name:h,osszegzes:g,sections:u,flashcards:x});if(!t.success){T.error("Javítsd ki a hibákat mielőtt mentenél!");return}d(t.data),T.success("Sikeres mentés!")},U=()=>{j([...u,{id:Date.now()*-1,content:"",subsections:[]}])},B=s=>{j(u.filter(t=>t.id!==s))},O=(s,t)=>{j(u.map(o=>o.id===s?{...o,content:t}:o))},P=s=>{j(u.map(t=>t.id===s?{...t,subsections:[...t.subsections,{id:Date.now()*-1,title:"",description:""}]}:t))},L=(s,t,o,n)=>{j(u.map(c=>c.id===s?{...c,subsections:c.subsections.map((N,_)=>_===t?{...N,[o]:n}:N)}:c))},W=(s,t)=>{j(u.map(o=>o.id===s?{...o,subsections:o.subsections.filter((n,c)=>c!==t)}:o))},J=()=>{w([...x,{id:Date.now()*-1,question:"",answer:""}])},K=(s,t,o)=>{w(x.map(n=>n.id===s?{...n,[t]:o}:n))},V=s=>{w(x.filter(t=>t.id!==s))};return e.jsxs("div",{children:[e.jsx(G,{}),e.jsx("div",{className:"max-w-6xl mx-auto items-center",children:e.jsx(H,{error:l,success:i,label:z,children:e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsx(k,{label:"Tétel címe",value:h,onChange:s=>{b(s.target.value),C({...f,name:!0})},error:f.name?S.name:void 0}),e.jsx(A,{label:"Összegzés",value:g,onChange:s=>{y(s.target.value),C({...f,osszegzes:!0})},error:f.osszegzes?S.osszegzes:void 0}),u.map((s,t)=>{const o={};return Object.entries(S).forEach(([n,c])=>{n.startsWith(`sections.${t}.`)&&(o[n.replace(`sections.${t}.`,"")]=c)}),e.jsx(Z,{index:s.id,section:s,onUpdateContent:n=>O(s.id,n),onAddSubsection:()=>P(s.id),onRemoveSection:()=>B(s.id),onUpdateSubsection:(n,c,N)=>L(s.id,n,c,N),onRemoveSubsection:n=>W(s.id,n),errors:f.sections?o:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:U,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Szekció"})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h4",{className:"text-md font-medium text-foreground",children:"FlashCard"})}),x.map((s,t)=>{const o={};return Object.entries(S).forEach(([n,c])=>{n.startsWith(`flashcards.${t}.`)&&(o[n.replace(`flashcards.${t}.`,"")]=c)}),e.jsx(D,{flashcard:s,onUpdate:(n,c)=>K(s.id,n,c),onRemove:()=>V(s.id),errors:f.flashcards?o:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:J,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új flashcard"})]}),e.jsx(I,{isPending:m,label:v})]})})})]})};export{re as T};
