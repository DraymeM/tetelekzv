import{u as P,e as I,d as B,r as a,y,j as e,S as k,N as D}from"./index-MfXWJZRy.js";import{u as L}from"./useQuery-Dld_li1V.js";import{u as T}from"./useMutation-C8t57buJ.js";import{z as i,F as H,S as R}from"./SubmitButton-DGDexfXE.js";import{l as V,j as $}from"./repo-WJTK3AE9.js";import{Q as G,A as J}from"./AnswerInput-OGDAWqdo.js";import"./utils-km2FGkQ4.js";const O=i.object({text:i.string().min(1,"A válasz szövege nem lehet üres"),isCorrect:i.boolean()}),S=i.object({question:i.string().min(1,"A kérdés megadása kötelező"),answers:i.array(O).length(4,"Pontosan négy válasz szükséges").refine(c=>c.some(r=>r.isCorrect),{message:"Legalább egy válasznak helyesnek kell lennie"})});function U(){const{id:c}=P({strict:!1}),r=Number(c),q=I(),f=B(),[u,d]=a.useState(""),[o,x]=a.useState([{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]),[p,Q]=a.useState({question:void 0,answers:[null,null,null,null]}),[g,h]=a.useState({question:!1,answers:[!1,!1,!1,!1]}),[N,m]=a.useState(!1),[z,b]=a.useState(null),{data:l,isLoading:C,error:E}=L({queryKey:["multiQuestions",r],queryFn:()=>$(r),enabled:!isNaN(r)});a.useEffect(()=>{l&&(d(l.question),x(l.answers))},[l]);const j=T({mutationFn:s=>V(r,s),onMutate:()=>{m(!0)},onSuccess:()=>{f.invalidateQueries({queryKey:["multiQuestion",r]}),f.invalidateQueries({queryKey:["multiQuestions"]}),b("Kérdés sikeresen frissítve!"),y.success("Kérdés frissítve!"),setTimeout(()=>{b(null),m(!1),q({to:`/mquestions/${r}`})},2e3)},onError:()=>{y.error("Nem sikerült frissíteni a kérdést."),m(!1)}});a.useEffect(()=>{const s=S.safeParse({question:u,answers:o}),t={question:void 0,answers:[null,null,null,null]};if(!s.success)for(const n of s.error.errors)n.path[0]==="question"?t.question=n.message:n.path[0]==="answers"&&typeof n.path[1]=="number"&&(t.answers[n.path[1]]=n.message);Q(t)},[u,o]);const M=(s,t,n)=>{const v=[...o];v[s][t]=n,x(v),h(w=>({...w,answers:w.answers.map((F,K)=>s===K?!0:F)}))},A=s=>{if(s.preventDefault(),!S.safeParse({question:u,answers:o}).success){h({question:!0,answers:[!0,!0,!0,!0]});return}j.mutate({question:u,answers:o})};return C?e.jsx("div",{className:"p-10 text-center text-gray-300",children:e.jsx(k,{})}):E?e.jsx("div",{children:"Hiba a betöltésnél."}):e.jsxs(e.Fragment,{children:[e.jsx(D,{}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundColor:"rgba(25, 25, 30, 0.3)"},children:e.jsx(k,{})}),e.jsx("div",{className:"max-w-4xl mx-auto mt-10",children:e.jsx(H,{error:null,success:z,label:"Kérdés szerkesztése",children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsx(G,{question:u,setQuestion:d,fieldErrors:p,touched:g}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Válaszok"}),o.map((s,t)=>e.jsx(J,{answer:s,index:t,updateAnswer:M,fieldErrors:p.answers[t],touched:g.answers[t]},t))]}),e.jsx(R,{isPending:j.isPending,label:"Mentés"})]})})})]})}const te=U;export{te as component};
