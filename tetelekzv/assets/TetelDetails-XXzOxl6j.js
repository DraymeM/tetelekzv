const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PlayPauseControls-Bh-Ad5xn.js","assets/index-vBRKwINY.js","assets/index-NQ_ZRRmA.css","assets/OfflinePlaceholder-j2sJlGF2.js","assets/VoiceSelector-DyKxNsPw.js","assets/SpeechSliders-DMK4FzJk.js","assets/index.module-BAR537hn.js","assets/MarkdownHandler-CYefjk3z.js"])))=>i.map(i=>d[i]);
import{r as t,j as e,aC as A,aV as B,aW as Q,_ as C,b as U,u as H,f as K,e as W,R as G,y as $,O as J,a as L,g as X,aG as Y,aI as Z,aJ as q}from"./index-vBRKwINY.js";import{u as ee}from"./useLocation-CKTtcwdv.js";import{u as te}from"./useQuery-CV_ZeyFs.js";import{u as re}from"./useMutation-B-TJnO2H.js";import{i as se,d as ne}from"./repo-rO_d9CsQ.js";import ae from"./DeleteModal-Dz8nE9Eu.js";import{P as oe}from"./PageTransition-B4Qkecvx.js";import{O as ie}from"./OfflinePlaceholder-j2sJlGF2.js";import{l as O}from"./menu-DDhGBfeL.js";function ce(){const r=t.useRef(null),[h,d]=t.useState([]),[a,w]=t.useState(!1),[j,c]=t.useState(!1),[P,k]=t.useState(!0),[_,S]=t.useState(null),s=t.useRef([]),n=t.useRef(0),m=t.useRef(!0),N=t.useRef("unknown"),y=t.useRef(!1),x=t.useRef({rate:1,pitch:1,volume:1}),b=t.useRef(""),p=typeof window<"u"&&"speechSynthesis"in window;t.useEffect(()=>{const o=navigator.userAgent.toLowerCase();y.current=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(o),o.includes("chrome")?N.current="chrome":o.includes("firefox")?N.current="firefox":o.includes("safari")?N.current="safari":o.includes("edge")&&(N.current="edge")},[]),t.useEffect(()=>{if(m.current=!0,!p){k(!1),S("Speech synthesis is not supported by your browser.");return}return r.current=window.speechSynthesis,(async()=>{if(!r.current)return;const g=5;let v=0;const i=()=>{const f=r.current.getVoices();f.length>0?m.current&&(console.log("Available voices:",f.map(u=>({name:u.name,lang:u.lang,localService:u.localService}))),d(f),k(!1),S(null)):v<g?(v++,setTimeout(i,1500)):m.current&&(k(!1),S("Failed to load voices after multiple attempts."))};k(!0),i(),r.current.onvoiceschanged=i})(),()=>{m.current=!1,E(),r.current&&(r.current.onvoiceschanged=null)}},[p]);const T=(o,g,v=1,i=1,f=1)=>{const u=new SpeechSynthesisUtterance(o);let M=g?h.find(V=>V.name===g):null;return M||(M=y.current&&h.find(V=>V.localService)||h[0]),M&&(u.voice=M),u.rate=Math.min(Math.max(v,.1),10),u.pitch=Math.min(Math.max(i,0),2),u.volume=Math.min(Math.max(f,0),1),u.onstart=()=>{m.current&&(w(!0),c(!1),S(null))},u.onend=()=>{if(m.current)if(n.current++,n.current<s.current.length)r.current.speak(s.current[n.current]);else if(b.current){const V=b.current.slice(0,300);b.current=b.current.slice(300),s.current=[T(V,g,x.current.rate,x.current.pitch,x.current.volume)],n.current=0,V?r.current.speak(s.current[0]):(w(!1),c(!1),n.current=0,s.current=[],b.current="")}else w(!1),c(!1),n.current=0,s.current=[],b.current=""},u.onerror=V=>{const I=`Speech Error: ${V.error}`;console.error(I),m.current&&(w(!1),c(!1),S(I),M&&!M.localService&&h.find(D=>D.localService)&&l(o,h.find(D=>D.localService)?.name,v,i,f))},u.onpause=()=>c(!0),u.onresume=()=>c(!1),u},l=(o,g,v=1,i=1,f=1)=>{if(!o||!p||!r.current||P){S("Cannot speak: Voices are still loading or not supported.");return}E(),x.current={rate:v,pitch:i,volume:f};const u=o.trim().replace(/\s+/g," "),M=u.match(/\S.{0,298}\s/g)||[u];console.log(`Total chunks: ${M.length}`),s.current=[T(M[0]||"",g,v,i,f)],b.current=M.slice(1).join(""),n.current=0,r.current.cancel(),s.current.length>0&&r.current.speak(s.current[0])},z=o=>{x.current={...x.current,...o};for(let g=n.current;g<s.current.length;g++){const v=s.current[g];o.rate&&(v.rate=Math.min(Math.max(o.rate,.1),10)),o.pitch&&(v.pitch=Math.min(Math.max(o.pitch,0),2)),o.volume&&(v.volume=Math.min(Math.max(o.volume,0),1))}if(a&&!j&&n.current<s.current.length){r.current.cancel();const g=s.current[n.current]?.text||"";s.current[n.current]=T(g,s.current[n.current]?.voice?.name,x.current.rate,x.current.pitch,x.current.volume),r.current.speak(s.current[n.current])}},R=()=>{!p||!r.current||!a||j||(r.current.pause(),c(!0))},F=()=>{!p||!r.current||!a||!j||(N.current==="safari"||y.current?n.current<s.current.length&&(r.current.cancel(),r.current.speak(s.current[n.current])):(r.current.resume(),c(!1)))},E=()=>{!p||!r.current||(r.current.cancel(),m.current&&(w(!1),c(!1),S(null),s.current=[],n.current=0,b.current=""))};return{voices:h,speak:l,pause:R,resume:F,stop:E,updateParams:z,isSpeaking:a,isPaused:j,isSupported:p,isLoadingVoices:P,error:_}}const le=t.lazy(()=>C(()=>import("./PlayPauseControls-Bh-Ad5xn.js"),__vite__mapDeps([0,1,2,3]))),ue=t.lazy(()=>C(()=>import("./VoiceSelector-DyKxNsPw.js"),__vite__mapDeps([4,1,2]))),de=t.lazy(()=>C(()=>import("./SpeechSliders-DMK4FzJk.js"),__vite__mapDeps([5,1,2,6]))),me=({text:r,className:h})=>{const{voices:d,speak:a,pause:w,resume:j,stop:c,updateParams:P,isSpeaking:k,isPaused:_,isSupported:S,isLoadingVoices:s,error:n}=ce(),[m,N]=t.useState(),[y,x]=t.useState(1),[b,p]=t.useState(1),[T,l]=t.useState(1),[z,R]=t.useState(!1),[F,E]=t.useState("");t.useEffect(()=>{if(d.length>0&&!m&&!s){const i=d.find(f=>f.localService)||d[0];N(i?.name)}},[d,m,s]),t.useEffect(()=>()=>c(),[]);const o=()=>{!r||d.length===0||s||(k?_?j():w():a(r,m,y,b,T))},g=i=>{N(i),R(!1),k&&(c(),a(r,i,y,b,T))},v=(i,f)=>{i==="rate"&&x(f),i==="pitch"&&p(f),i==="volume"&&l(f),P({[i]:f})};return e.jsx(O,{as:"div",className:`relative inline-block text-left ${h??""}`,children:({open:i})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex space-x-0",children:[e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(A,{className:"animate-spin text-primary text-3xl"})}),children:e.jsx(le,{isSpeaking:k,isPaused:_,hasVoices:d.length>0&&!s,onClick:o})}),e.jsx(O.Button,{className:"inline-flex items-center px-2 py-2.5 bg-blue-600 border-l-2 border-blue-800 hover:cursor-pointer rounded-r-md text-sm font-medium text-white hover:bg-blue-700","aria-label":"Felolvasási Beállítások",title:"Felolvasási Beállítások",disabled:s||!S,children:e.jsx(B,{size:16,className:`transition-transform duration-300 ${i?"rotate-180":"rotate-0"}`})})]}),e.jsx(O.Items,{className:"absolute right-0 mt-2 w-64 bg-secondary border border-border rounded-md shadow-lg p-4 space-y-4 max-h-[400px] overflow-auto z-50",children:e.jsxs(t.Suspense,{fallback:e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(A,{className:"animate-spin text-primary min-h-[300px] max-w-[50px] text-4xl"})}),children:[n&&e.jsx("div",{className:"text-red-600 text-sm mb-2",children:n}),s&&e.jsx("div",{className:"text-gray-600 text-sm mb-2",children:"Loading voices..."}),e.jsx(ue,{voices:d,selectedVoice:m,isDropdownOpen:z,setDropdownOpen:R,searchTerm:F,setSearchTerm:E,handleVoiceChange:g}),e.jsx(de,{rate:y,pitch:b,volume:T,onChange:v}),e.jsx("div",{className:"flex justify-between mt-2",children:e.jsxs("button",{onClick:c,disabled:!k,className:`inline-flex items-center px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 transition ${k?"":"opacity-50 cursor-not-allowed"}`,children:[e.jsx(Q,{}),e.jsx("span",{className:"ml-2",children:"Stop"})]})})]})})]})})};function fe(r,h){const d=j=>j.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim();let a="";r.forEach(j=>{a+=" "+d(j.content),j.subsections?.forEach(c=>{a+=" "+d(c.title||""),a+=" "+d(c.description||"")})}),h?.content&&(a+=" "+d(h.content));const w=a.split(" ").filter(Boolean).length;return Math.ceil(w/200)}function we(){const{isAuthenticated:r,isSuperUser:h}=U(),{id:d}=H({strict:!1}),a=Number(d),w=ee(),j=K(),c=W(),P=w.pathname.includes("/edit"),[k,_]=t.useState(!1),{data:S,error:s}=te({queryKey:["tetelDetail",a],queryFn:()=>ne(a),enabled:!isNaN(a)&&a>0,retry:2,refetchOnWindowFocus:!1});t.useEffect(()=>{window.scrollTo({top:0,behavior:"auto"})},[w.pathname]);const n=G.lazy(()=>C(()=>import("./MarkdownHandler-CYefjk3z.js").then(l=>l.M),__vite__mapDeps([7,1,2]))),m=re({mutationFn:()=>{if(!r||!h)throw $.error("Nincs engedélyed a művelethez"),new Error("Nincs engedélyed a művelethez");return se(a)},onSuccess:()=>{c.invalidateQueries({queryKey:["tetelek"]}),$.success("Sikeresen törölted a tételt."),j({to:"/tetelek"})}});if(s)return navigator.onLine?e.jsxs("div",{className:"p-10 text-red-500 text-center",children:["Hiba történt: ",s.message]}):e.jsx(ie,{});if(P)return e.jsx(J,{});const N=S?.tetel??{name:"Ismeretlen tétel"},y=S?.osszegzes,x=S?.sections??[],b=fe(x,y),p=l=>l.replace(/[#_*>\-`]/g,"").replace(/\[.*?\]\(.*?\)/g,"").replace(/!\[.*?\]\(.*?\)/g,"").replace(/`{1,3}[\s\S]*?`{1,3}/g,"").replace(/\s+/g," ").trim(),T=[p(N.name),...x.flatMap(l=>[p(l.content),...l.subsections?.flatMap(z=>[p(z.title||""),p(z.description||"")])??[]]),y?.content?"Összegzés: "+p(y.content):""].filter(l=>l&&l.length>0).join(" ").trim();return e.jsx(t.Suspense,{children:e.jsxs("main",{className:"relative md:max-w-7xl max-w-full mb-5 mx-auto mt-10 md:px-10 px-3 pt-10 pb-1 text-left",children:[e.jsxs(oe,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs(L,{to:"/tetelek/$id",params:{id:a.toString()},className:"inline-flex items-center px-3 py-2 border border-border rounded-md text-sm font-medium text-muted-foreground hover:bg-muted hover:text-foreground focus:outline-none focus:ring-2 focus:ring-primary transition-colors","aria-label":"Vissza a tétel áttekintéséhez",title:"Vissza a tételhez",children:[e.jsx(X,{className:"mr-2","aria-hidden":"true"}),"Vissza"]}),e.jsxs("div",{className:"flex items-center gap-4 ",children:[e.jsxs("span",{className:"text-sm mx-auto text-secondary-foreground",children:[e.jsx(Y,{className:"inline mr-1",size:15,"aria-hidden":"true"}),b," perc"]}),e.jsx(me,{text:T})]})]}),e.jsx("h1",{className:"text-3xl font-bold mb-8 text-center text-foreground",children:N.name}),e.jsxs("div",{className:"space-y-6",children:[x.map(l=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow-xl border border-transparent hover:border-border transition-colors",children:[e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"bg-secondary rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsx("div",{className:"text-xl font-semibold mb-4 text-foreground",children:e.jsx(n,{content:l.content})})}),l.subsections?.map(z=>e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"bg-muted rounded-lg p-6 shadow-xl animate-pulse "}),children:e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium text-foreground mb-2",children:e.jsx(n,{content:z.title})}),e.jsx("div",{className:"text-secondary-foreground prose prose-invert max-w-none",children:e.jsx(n,{content:z.description})})]})},z.id))]},l.id)),y?.content&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 border border-transparent hover:border-border transition-colors",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4 text-foreground",children:"Összegzés"}),e.jsx("div",{className:"text-foreground prose prose-invert max-w-none whitespace-pre-wrap",children:e.jsx(n,{content:y.content})})]})]}),e.jsx(ae,{isOpen:k,onClose:()=>_(!1),onDelete:()=>m.mutate(),isDeleting:m.isPending,itemName:N.name})]}),r&&h?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>_(!0),className:"fixed md:bottom-7 bottom-14 right-5 p-3 bg-rose-600 text-white rounded-full hover:bg-rose-700 hover:cursor-pointer transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Töröld a tételt","aria-label":"Töröld a tételt",children:e.jsx(Z,{size:20,"aria-hidden":"true"})}),e.jsx(L,{to:"/tetelek/$id/details/edit",params:{id:a.toString()},className:"fixed md:bottom-22 bottom-28 right-5 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(q,{size:20,"aria-hidden":"true"})})]}):r?e.jsx(L,{to:"/tetelek/$id/details/edit",params:{id:a.toString()},className:"fixed md:bottom-7 bottom-14 right-5 p-3 bg-blue-600 text-white rounded-full hover:bg-blue-700 transition-all transform hover:scale-105 flex items-center justify-center z-50",title:"Szerkeszd a tételt","aria-label":"Szerkeszd a tételt",children:e.jsx(q,{size:20,"aria-hidden":"true"})}):null]})})}export{we as T};
