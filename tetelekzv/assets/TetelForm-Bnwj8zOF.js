import{j as e,C as E,b as F,r as g,N as G,y as T}from"./index-CyLvEBSo.js";import{z as a,F as H,S as I}from"./SubmitButton-BYBxVvoL.js";import{I as N}from"./InputField-C8K4h3A6.js";const M=a.object({id:a.number().optional(),title:a.string().min(1,"A cím nem lehet üres!"),description:a.string()}),Q=a.object({id:a.number().optional(),content:a.string().min(1,"A szekció tartalma nem lehet üres!"),subsections:a.array(M).nullable().transform(r=>r||[])}),X=a.object({id:a.number().optional(),question:a.string().min(1,"Üresen ne hagyd, zerd be ha nem akarsz."),answer:a.string().min(1,"Üresen ne hagyd, zerd be ha nem akarsz.")}),$=a.object({name:a.string().min(1,"Tétel cím megadása kötelező!"),osszegzes:a.string().min(1,"Összegzés megadása kötelező!"),sections:a.array(Q).min(1,"Legalább egy szekció legyen!"),flashcards:a.array(X).nullable().transform(r=>r||[])}),A=({label:r,value:d,onChange:u,error:l})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:r}),e.jsx("textarea",{rows:4,className:`w-full p-2 rounded bg-gray-800 text-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 ${l?"border border-red-500":"border border-gray-700"}`,value:d,onChange:u}),l&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:l})]}),Y=({subsection:r,onUpdate:d,onRemove:u,errors:l={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:u,className:"absolute -top-3 -right-3 text-red-500 bg-gray-900 rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(N,{label:"Cím",value:r.title,onChange:i=>d("title",i.target.value),error:l.title}),e.jsx(A,{label:"Leírás",value:r.description,onChange:i=>d("description",i.target.value),error:l.description})]}),Z=({onUpdateContent:r,onAddSubsection:d,onRemoveSection:u,onUpdateSubsection:l,onRemoveSubsection:i,section:z,errors:f={}})=>e.jsxs("div",{className:"p-4 border rounded-lg border-gray-700 relative group",children:[e.jsx("button",{type:"button",onClick:u,className:"absolute -top-3 -right-3 text-red-500 bg-gray-900 rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx(A,{label:"Szekció tartalma",value:z.content,onChange:h=>r(h.target.value),error:f.content}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-gray-400",children:"Alszekciók"}),z.subsections.map((h,b)=>e.jsx(Y,{subsection:h,onRemove:()=>i(b),onUpdate:(p,k)=>l(b,p,k),errors:{title:f[`subsections.${b}.title`],description:f[`subsections.${b}.description`]}},b)),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:d,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Alszekció"})]})]})]}),D=({flashcard:r,onUpdate:d,onRemove:u,errors:l={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:u,className:"absolute -top-3 -right-3 text-red-500 bg-gray-900 rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(E,{className:"w-5 h-5"})}),e.jsx("hr",{className:"border-t-2 border-gray-300 w-full my-2"}),e.jsx(N,{label:"Kérdés",value:r.question,onChange:i=>d("question",i.target.value),error:l.question}),e.jsx(N,{label:"Válasz",value:r.answer,onChange:i=>d("answer",i.target.value),error:l.answer})]}),re=({initialData:r,onSubmit:d,isPending:u,error:l,success:i,label:z,submitLabel:f})=>{const[h,b]=g.useState((r==null?void 0:r.name)||""),[p,k]=g.useState((r==null?void 0:r.osszegzes)||""),[m,j]=g.useState((r==null?void 0:r.sections)||[{content:"",subsections:[]}]),[x,w]=g.useState((r==null?void 0:r.flashcards)||[]),[y,R]=g.useState({}),[v,C]=g.useState({});g.useEffect(()=>{const s=$.safeParse({name:h,osszegzes:p,sections:m,flashcards:x});if(s.success)R({});else{const t={};s.error.errors.forEach(n=>{t[n.path.join(".")]=n.message}),R(t)}},[h,p,m,x]);const q=s=>{s.preventDefault(),C({name:!0,osszegzes:!0,sections:!0,flashcards:!0});const t=$.safeParse({name:h,osszegzes:p,sections:m,flashcards:x});if(!t.success){T.error("Javítsd ki a hibákat mielőtt mentenél!");return}d(t.data),T.success("Sikeres mentés!")},U=()=>{j([...m,{id:Date.now()*-1,content:"",subsections:[]}])},B=s=>{j(m.filter(t=>t.id!==s))},O=(s,t)=>{j(m.map(n=>n.id===s?{...n,content:t}:n))},P=s=>{j(m.map(t=>t.id===s?{...t,subsections:[...t.subsections,{id:Date.now()*-1,title:"",description:""}]}:t))},L=(s,t,n,o)=>{j(m.map(c=>c.id===s?{...c,subsections:c.subsections.map((S,_)=>_===t?{...S,[n]:o}:S)}:c))},W=(s,t)=>{j(m.map(n=>n.id===s?{...n,subsections:n.subsections.filter((o,c)=>c!==t)}:n))},J=()=>{w([...x,{id:Date.now()*-1,question:"",answer:""}])},K=(s,t,n)=>{w(x.map(o=>o.id===s?{...o,[t]:n}:o))},V=s=>{w(x.filter(t=>t.id!==s))};return e.jsxs("div",{children:[e.jsx(G,{}),e.jsx("div",{className:"max-w-6xl mx-auto items-center",children:e.jsx(H,{error:l,success:i,label:z,children:e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[e.jsx(N,{label:"Tétel címe",value:h,onChange:s=>{b(s.target.value),C({...v,name:!0})},error:v.name?y.name:void 0}),e.jsx(A,{label:"Összegzés",value:p,onChange:s=>{k(s.target.value),C({...v,osszegzes:!0})},error:v.osszegzes?y.osszegzes:void 0}),m.map((s,t)=>{const n={};return Object.entries(y).forEach(([o,c])=>{o.startsWith(`sections.${t}.`)&&(n[o.replace(`sections.${t}.`,"")]=c)}),e.jsx(Z,{index:s.id,section:s,onUpdateContent:o=>O(s.id,o),onAddSubsection:()=>P(s.id),onRemoveSection:()=>B(s.id),onUpdateSubsection:(o,c,S)=>L(s.id,o,c,S),onRemoveSubsection:o=>W(s.id,o),errors:v.sections?n:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:U,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új Szekció"})]}),e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h4",{className:"text-md font-medium text-gray-400",children:"FlashCard"})}),x.map((s,t)=>{const n={};return Object.entries(y).forEach(([o,c])=>{o.startsWith(`flashcards.${t}.`)&&(n[o.replace(`flashcards.${t}.`,"")]=c)}),e.jsx(D,{flashcard:s,onUpdate:(o,c)=>K(s.id,o,c),onRemove:()=>V(s.id),errors:v.flashcards?n:{}},s.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:J,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(F,{size:15})}),e.jsx("span",{children:"Új flashcard"})]}),e.jsx(I,{isPending:u,label:f})]})})})]})};export{re as T};
