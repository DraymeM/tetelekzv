import{r as l,j as o}from"./index-BV4Ew1CB.js";import{a as B}from"./index-BfYvBwUB.js";const C=({open:a,onClose:f,steps:i})=>{const[t,b]=l.useState(0),[r,k]=l.useState(null),[T,E]=l.useState(!1),h=l.useRef(null),m=l.useRef(null),x=l.useRef(null),g=l.useRef(null),L=l.useRef(null),I=l.useRef(null),u=10,R=320,j=140,c=50,N=5,S=500,M=(e,n)=>()=>{g.current&&clearTimeout(g.current),g.current=setTimeout(e,n)};l.useEffect(()=>{if(a)return document.body.style.overflow="hidden",I.current=document.activeElement,L.current?.focus(),()=>{document.body.style.overflow="",I.current?.focus()}},[a]);const q=e=>{if(!e)return!1;const n=e.getBoundingClientRect();return n.width>0&&n.height>0&&e.offsetParent!==null&&window.getComputedStyle(e).display!=="none"},v=(e,n=0)=>{const s=document.querySelector(e?.selector||"");if(s&&q(s)){s.scrollIntoView({behavior:"auto",block:"center",inline:"center"});const w=s.getBoundingClientRect();k(w)}else n<N?x.current=setTimeout(()=>{v(e,n+1)},S):t<i.length-1?b(w=>w+1):f()};if(l.useEffect(()=>{const e=n=>{a&&(n.key==="Escape"?f():n.key==="Enter"&&!i[t].requiresInteraction&&(t===i.length-1?f():b(s=>s+1)))};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[a,t,i,f]),l.useEffect(()=>{if(!a){b(0),k(null),E(!1),m.current&&m.current.disconnect(),x.current&&clearTimeout(x.current);return}const e=i[t];if(h.current&&(document.removeEventListener("click",h.current),h.current=null),E(!e?.requiresInteraction),e?.requiresInteraction){const s=document.querySelector(e.selector);if(s){const w=K=>{s.contains(K.target)&&E(!0)};document.addEventListener("click",w),h.current=w}}m.current=new MutationObserver(()=>{v(e)}),m.current.observe(document.body,{childList:!0,subtree:!0}),v(e);const n=M(()=>{v(e)},200);return window.addEventListener("resize",n),()=>{h.current&&document.removeEventListener("click",h.current),m.current&&m.current.disconnect(),x.current&&clearTimeout(x.current),g.current&&clearTimeout(g.current),window.removeEventListener("resize",n)}},[t,a,i]),!a||!r)return null;const W=r.top;let p=0,y="down";W>j+c+u?(p=r.top-u-j-c,y="down"):(p=r.bottom+u+c,y="up");let d=r.left;d+R>window.innerWidth-u&&(d=window.innerWidth-R-u),d<u&&(d=u);let z=r.left+r.width/2-d-c/2;z=Math.min(Math.max(z,c),R-c*2);const $=[{top:0,left:0,width:window.innerWidth,height:Math.max(0,r.top)},{top:r.top,left:0,width:Math.max(0,r.left),height:r.height},{top:r.top,left:r.right,width:Math.max(0,window.innerWidth-r.right),height:r.height},{top:r.bottom,left:0,width:window.innerWidth,height:Math.max(0,window.innerHeight-r.bottom)}];return o.jsxs(o.Fragment,{children:[$.map((e,n)=>e.width>0&&e.height>0&&o.jsx("div",{className:"fixed bg-black/60 pointer-events-auto",style:{top:e.top,left:e.left,width:e.width,height:e.height},"aria-hidden":"true"},n)),o.jsxs("div",{ref:L,role:"dialog","aria-modal":"true","aria-labelledby":`tutorial-step-${t}-title`,tabIndex:-1,className:"fixed z-[99999] w-[320px] border-border border-2 rounded-xl bg-secondary text-foreground shadow-2xl p-4 font-sans",style:{top:p,left:d},children:[o.jsx("h3",{id:`tutorial-step-${t}-title`,className:"text-lg font-bold mb-2",children:i[t].title}),o.jsx("p",{className:"text-sm mb-4","aria-live":"polite",children:i[t].content}),o.jsxs("div",{className:"flex justify-between gap-2",children:[o.jsx("button",{onClick:f,className:"px-3 py-1 rounded text-white hover:cursor-pointer bg-rose-700 hover:bg-rose-800 text-sm","aria-label":"Kilépés a tutorialból",children:"Kilépés"}),o.jsxs("div",{className:"flex gap-2",children:[o.jsx("button",{disabled:t===0,onClick:()=>b(e=>Math.max(e-1,0)),className:`px-3 py-1 rounded text-sm border border-gray-500 ${t===0?"opacity-50 cursor-not-allowed":"hover:bg-muted hover:cursor-pointer"}`,"aria-label":"Előző lépés",children:"Előző"}),o.jsx("button",{onClick:()=>{t===i.length-1?f():b(e=>e+1)},disabled:i[t].requiresInteraction&&!T,className:`px-3 py-1 rounded text-white text-sm ${i[t].requiresInteraction&&!T?"bg-gray-500 cursor-not-allowed":"bg-blue-600 hover:bg-blue-700 hover:cursor-pointer"}`,"aria-label":t===i.length-1?"Tutorial befejezése":"Következő lépés",children:t===i.length-1?"Befejezés":"Következő"})]})]})]}),o.jsx("div",{className:`fixed z-[99999] text-white mt-5 ${y==="down"?"-rotate-90":"rotate-90"}`,style:{top:y==="down"?p+j:p-c,left:d+z,fontSize:`${c}px`},"aria-hidden":"true",children:o.jsx(B,{size:c})})]})};export{C as default};
