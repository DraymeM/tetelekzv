const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/InputField-DuF9AuEw.js","assets/index-Bdew73EK.js","assets/index-BIK1NIZ9.css","assets/FormContainer-Cu61MWp9.js","assets/SubmitButton-C_oob6xQ.js"])))=>i.map(i=>d[i]);
import{j as e,r as j,aP as V,R as B,_ as D,d as H,v as ie,aT as de,S as ce,g as K}from"./index-Bdew73EK.js";import{z as b}from"./index-ByYdXFAB.js";import{M as P}from"./MarkdownHandler-RRokKPSw.js";import le from"./FlashCard-BcgS0Fp9.js";import I from"./InputField-DuF9AuEw.js";import{P as X}from"./PageTransition-DbzD7rLm.js";import{H as Y}from"./index-8LRWd8sf.js";const M=b.preprocess(s=>s!==void 0?Number(s):void 0,b.number()).optional(),ue=b.object({id:M,title:b.string().min(1,"A cím nem lehet üres!"),description:b.string()}),me=b.object({id:M,content:b.string().min(1,"A szekció tartalma nem lehet üres!"),subsections:b.array(ue).nullable().transform(s=>s||[])}),he=b.object({id:M,question:b.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz."),answer:b.string().min(1,"Üresen ne hagyd, zárd be ha nem akarsz.")}),G=b.object({name:b.string().min(1,"Tétel cím megadása kötelező!"),osszegzes:b.string().min(1,"Összegzés megadása kötelező!"),sections:b.array(me).min(1,"Legalább egy szekció legyen!"),flashcards:b.array(he).nullable().transform(s=>s||[])});function pe({data:s}){return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-center",children:s.name}),s.sections.map(t=>e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow transition-colors hover:border-border border border-transparent",children:[e.jsx("div",{className:"text-xl font-semibold mb-4",children:e.jsx(P,{content:t.content})}),t.subsections.map(r=>e.jsxs("div",{className:"ml-4 mb-4 p-4 bg-muted rounded-lg",children:[e.jsx("div",{className:"font-medium mb-2",children:e.jsx(P,{content:r.title})}),e.jsx("div",{className:"prose prose-invert",children:e.jsx(P,{content:r.description})})]},r.id))]},t.id)),s.osszegzes&&e.jsxs("div",{className:"bg-secondary rounded-lg p-6 shadow transition-colors hover:border-border border border-transparent",children:[e.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Összegzés"}),e.jsx("div",{className:"whitespace-pre-wrap prose prose-invert",children:e.jsx(P,{content:s.osszegzes})})]}),s.flashcards.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"text-2xl font-bold",children:"Flashcards"}),e.jsx("div",{className:"flex  ml-5 md:ml-15 mr-5 flex-wrap gap-2",children:s.flashcards.map(t=>e.jsx(le,{question:t.question,answer:t.answer},t.id))})]})]})}const U=({label:s,value:t,onChange:r,error:i})=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-foreground mb-2",children:s}),e.jsx("textarea",{rows:4,className:`w-full p-2 rounded bg-secondary text-foreground focus:outline-none focus:ring-2 focus:ring-primary ${i?"border border-red-500":"border border-border"}`,value:t,onChange:r}),i&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:i})]}),xe=({name:s,handleNameChange:t,osszegzes:r,handleOsszegzesChange:i,errorName:l,errorOsszegzes:v})=>e.jsxs("div",{children:[e.jsx(I,{label:"Tétel címe",value:s,onChange:t,error:l}),e.jsx(U,{label:"Összegzés",value:r,onChange:i,error:v})]}),be=B.lazy(()=>D(()=>import("./InputField-DuF9AuEw.js"),__vite__mapDeps([0,1,2]))),je=({subsection:s,onUpdate:t,onRemove:r,errors:i={}})=>e.jsx(j.Suspense,{children:e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:r,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx(be,{label:"Cím",value:s.title,onChange:l=>t("title",l.target.value),error:i.title}),e.jsx(U,{label:"Leírás",value:s.description,onChange:l=>t("description",l.target.value),error:i.description})]})}),fe=({onUpdateContent:s,onAddSubsection:t,onRemoveSection:r,onUpdateSubsection:i,onRemoveSubsection:l,section:v,errors:p={}})=>e.jsx(j.Suspense,{children:e.jsxs("div",{className:"p-4 border rounded-lg border-border relative group",children:[e.jsx("button",{type:"button",onClick:r,className:"absolute -top-3 -right-3 text-red-500 bg-background rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx(U,{label:"Szekció tartalma",value:v.content,onChange:d=>s(d.target.value),error:p.content}),e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsx("h4",{className:"text-md font-medium text-foreground",children:"Alszekciók"}),v.subsections.map((d,u)=>e.jsx(je,{subsection:d,onRemove:()=>l(u),onUpdate:(o,a)=>i(u,o,a),errors:{title:p[`subsections.${u}.title`],description:p[`subsections.${u}.description`]}},u)),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:t,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 hover:cursor-pointer text-white hover:bg-emerald-700",children:e.jsx(H,{size:15})}),e.jsx("span",{children:"Új Alszekció"})]})]})]})}),ve=({sections:s,openSections:t,setOpenSections:r,addSection:i,removeSection:l,updateSection:v,addSub:p,updateSub:d,removeSub:u,fieldErrors:o,showSectionErrors:a})=>e.jsxs("div",{className:"space-y-4",children:[s.map((n,c)=>{const g=t[n.id],x={};return Object.entries(o).forEach(([f,S])=>{f.startsWith(`sections.${c}.`)&&(x[f.replace(`sections.${c}.`,"")]=S)}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"w-full flex justify-between p-4 bg-secondary rounded-md hover:cursor-pointer",onClick:()=>r({...t,[n.id]:!g}),children:[e.jsxs("span",{className:"font-medium",children:["Szekció #",c+1]}),e.jsx(Y,{className:`transform transition-transform duration-300 ${g?"rotate-180":"rotate-0"}`,size:30})]}),e.jsx(X,{show:g,children:e.jsx("div",{className:"p-4 border border-border rounded-b-md",children:e.jsx(fe,{index:c,section:n,onUpdateContent:f=>v(n.id,f),onAddSubsection:()=>p(n.id),onRemoveSection:()=>l(n.id),onUpdateSubsection:(f,S,T)=>d(n.id,f,S,T),onRemoveSubsection:f=>u(n.id,f),errors:a?x:{}})})})]},n.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:i,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 hover:cursor-pointer",children:e.jsx(H,{size:15})}),e.jsx("span",{children:"Új Szekció"})]})]}),ge=({flashcard:s,onUpdate:t,onRemove:r,errors:i={}})=>e.jsxs("div",{className:"space-y-2 relative group",children:[e.jsx("button",{type:"button",onClick:r,className:"absolute -top-3 -right-3 text-red-500 bg-secondary rounded-full p-1 hover:bg-red-500/20 hover:cursor-pointer",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsx("hr",{className:"border-t-2 border-border w-full my-2"}),e.jsx(I,{label:"Kérdés",value:s.question,onChange:l=>t("question",l.target.value),error:i.question}),e.jsx(I,{label:"Válasz",value:s.answer,onChange:l=>t("answer",l.target.value),error:i.answer})]}),ze=({flashcards:s,openFlashcards:t,setOpenFlashcards:r,addFlashcard:i,removeFlashcard:l,updateFlashcard:v,fieldErrors:p,showFlashcardErrors:d})=>e.jsxs("div",{className:"space-y-4 mt-6",children:[s.map((u,o)=>{const a=t[u.id],n={};return Object.entries(p).forEach(([c,g])=>{c.startsWith(`flashcards.${o}.`)&&(n[c.replace(`flashcards.${o}.`,"")]=g)}),e.jsxs("div",{children:[e.jsxs("button",{type:"button",className:"w-full flex justify-between p-4 bg-secondary rounded-md hover:cursor-pointer",onClick:()=>r({...t,[u.id]:!a}),children:[e.jsxs("span",{className:"font-medium",children:["Flashcard #",o+1]}),e.jsx(Y,{className:`transform transition-transform duration-300 ${a?"rotate-180":"rotate-0"}`,size:30})]}),e.jsx(X,{show:a,children:e.jsx("div",{className:"p-4 border border-secondary rounded-b-md",children:e.jsx(ge,{flashcard:u,onUpdate:(c,g)=>v(u.id,c,g),onRemove:()=>l(u.id),errors:d?n:{}})})})]},u.id)}),e.jsxs("div",{className:"flex items-center space-x-2 text-emerald-600",children:[e.jsx("button",{type:"button",onClick:i,className:"flex items-center justify-center p-2 rounded-full bg-emerald-600 text-white hover:bg-emerald-700 hover:cursor-pointer",children:e.jsx(H,{size:15})}),e.jsx("span",{children:"Új flashcard"})]})]});let L=Date.now();function q(s){return s&&s.id!=null?s:{id:++L,content:s?.content??"",subsections:s?.subsections?.map(t=>({id:++L,title:t.title,description:t.description}))??[]}}function Se(s){const[t,r]=j.useState(s?.map(q)??[q()]);return{sections:t,addSection:()=>{const o=q();return r(a=>[...a,o]),o},removeSection:o=>r(a=>a.filter(n=>n.id!==o)),updateSection:(o,a)=>r(n=>n.map(c=>c.id===o?{...c,content:a}:c)),addSub:o=>r(a=>a.map(n=>n.id===o?{...n,subsections:[...n.subsections,{id:++L,title:"",description:""}]}:n)),updateSub:(o,a,n,c)=>r(g=>g.map(x=>x.id===o?{...x,subsections:x.subsections.map((f,S)=>S===a?{...f,[n]:c}:f)}:x)),removeSub:(o,a)=>r(n=>n.map(c=>c.id===o?{...c,subsections:c.subsections.filter((g,x)=>x!==a)}:c))}}let Ne=Date.now();function Q(s){return s&&s.id!=null?s:{id:++Ne,question:s?.question??"",answer:s?.answer??""}}function we(s){const[t,r]=j.useState(s?.map(Q)??[]);return{flashcards:t,addFlashcard:()=>{const p=Q();return r(d=>[...d,p]),p},updateFlashcard:(p,d,u)=>r(o=>o.map(a=>a.id===p?{...a,[d]:u}:a)),removeFlashcard:p=>r(d=>d.filter(u=>u.id!==p))}}const ye=B.lazy(()=>D(()=>import("./FormContainer-Cu61MWp9.js"),__vite__mapDeps([3,1,2]))),ke=B.lazy(()=>D(()=>import("./SubmitButton-C_oob6xQ.js"),__vite__mapDeps([4,1,2])));function Ae({initialData:s,onSubmit:t,isPending:r,error:i,success:l,label:v,submitLabel:p}){const{sections:d,addSection:u,removeSection:o,updateSection:a,addSub:n,updateSub:c,removeSub:g}=Se(s?.sections),{flashcards:x,addFlashcard:f,updateFlashcard:S,removeFlashcard:T}=we(s?.flashcards),[y,Z]=j.useState(s?.name||""),[k,ee]=j.useState(s?.osszegzes||""),[E,W]=j.useState({}),[_,O]=j.useState({}),[se,A]=j.useState(()=>d.reduce((m,h,N)=>({...m,[h.id]:N===0}),{})),[te,$]=j.useState(()=>x.reduce((m,h)=>({...m,[h.id]:!1}),{})),[R,re]=j.useState(!1);j.useEffect(()=>{const m=G.safeParse({name:y,osszegzes:k,sections:d,flashcards:x});if(m.success)W({});else{const h={};m.error.errors.forEach(N=>{h[N.path.join(".")]=N.message}),W(h)}},[y,k,d,x]),j.useEffect(()=>{(i||l)&&window.scrollTo({top:0,behavior:"smooth"})},[i,l]);const ne=m=>{m.preventDefault(),O({name:!0,osszegzes:!0,sections:!0,flashcards:!0});const h=G.safeParse({name:y,osszegzes:k,sections:d,flashcards:x});if(!h.success){K.error("Javítsd ki a hibákat mielőtt mentenél!");const N=new Set,J=new Set;h.error.errors.forEach(F=>{const[z,w]=F.path;if(z==="sections"){const C=d[w]?.id;C!=null&&N.add(C)}if(z==="flashcards"){const C=x[w]?.id;C!=null&&J.add(C)}}),A(F=>{const z={...F};return N.forEach(w=>z[w]=!0),z}),$(F=>{const z={...F};return J.forEach(w=>z[w]=!0),z});return}t(h.data),K.success("Sikeres mentés!")},ae=()=>{const m=u();A(h=>({...h,[m.id]:!0}))},oe=()=>{const m=f();$(h=>({...h,[m.id]:!0}))};return e.jsx("div",{children:e.jsx(j.Suspense,{fallback:e.jsx(ce,{}),children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"flex justify-end mb-4",children:e.jsx("button",{onClick:()=>re(m=>!m),className:"fixed bottom-7 right-7 p-3 bg-purple-600 text-white rounded-full hover:bg-purple-700 hover:scale-105 transition-all z-50",title:R?"Vissza szerkesztéshez":"Előnézet",children:R?e.jsx(ie,{size:20}):e.jsx(de,{size:20})})}),e.jsx(ye,{error:i,success:l,label:v,children:e.jsx("form",{onSubmit:ne,className:"space-y-6",children:R?e.jsx(pe,{data:{name:y,osszegzes:k,sections:d,flashcards:x}}):e.jsxs(e.Fragment,{children:[e.jsx(xe,{name:y,handleNameChange:m=>{Z(m.target.value),O(h=>({...h,name:!0}))},osszegzes:k,handleOsszegzesChange:m=>{ee(m.target.value),O(h=>({...h,osszegzes:!0}))},errorName:_.name?E.name:void 0,errorOsszegzes:_.osszegzes?E.osszegzes:void 0}),e.jsx(ve,{sections:d,openSections:se,setOpenSections:A,addSection:ae,removeSection:o,updateSection:a,addSub:n,updateSub:c,removeSub:g,fieldErrors:E,showSectionErrors:_.sections}),e.jsx(ze,{flashcards:x,openFlashcards:te,setOpenFlashcards:$,addFlashcard:oe,removeFlashcard:T,updateFlashcard:S,fieldErrors:E,showFlashcardErrors:_.flashcards}),e.jsx(ke,{isPending:r,label:p})]})})})]})})})}export{Ae as default};
