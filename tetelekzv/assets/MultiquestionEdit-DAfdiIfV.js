import{u as P,d as I,b as B,r as a,y,j as e,S as k,N as D}from"./index-GncX1r6g.js";import{u as L}from"./useQuery-D_39Ub9U.js";import{u as T}from"./useMutation-oDiw3r_r.js";import{z as o,F as H,S as R}from"./SubmitButton-B8SN_Nro.js";import{l as V,j as $}from"./repo-HgviLFAr.js";import{Q as G,A as J}from"./AnswerInput-B1hK8_07.js";const O=o.object({text:o.string().min(1,"A válasz szövege nem lehet üres"),isCorrect:o.boolean()}),q=o.object({question:o.string().min(1,"A kérdés megadása kötelező"),answers:o.array(O).length(4,"Pontosan négy válasz szükséges").refine(c=>c.some(r=>r.isCorrect),{message:"Legalább egy válasznak helyesnek kell lennie"})});function ee(){const{id:c}=P({strict:!1}),r=Number(c),S=I(),f=B(),[u,d]=a.useState(""),[i,x]=a.useState([{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1},{text:"",isCorrect:!1}]),[g,Q]=a.useState({question:void 0,answers:[null,null,null,null]}),[p,h]=a.useState({question:!1,answers:[!1,!1,!1,!1]}),[N,m]=a.useState(!1),[z,b]=a.useState(null),{data:l,isLoading:E,error:C}=L({queryKey:["multiQuestions",r],queryFn:()=>$(r),enabled:!isNaN(r)});a.useEffect(()=>{l&&(d(l.question),x(l.answers))},[l]);const j=T({mutationFn:s=>V(r,s),onMutate:()=>{m(!0)},onSuccess:()=>{f.invalidateQueries({queryKey:["multiQuestion",r]}),f.invalidateQueries({queryKey:["multiQuestions"]}),b("Kérdés sikeresen frissítve!"),y.success("Kérdés frissítve!"),setTimeout(()=>{b(null),m(!1),S({to:`/mquestions/${r}`})},2e3)},onError:()=>{y.error("Nem sikerült frissíteni a kérdést."),m(!1)}});a.useEffect(()=>{const s=q.safeParse({question:u,answers:i}),t={question:void 0,answers:[null,null,null,null]};if(!s.success)for(const n of s.error.errors)n.path[0]==="question"?t.question=n.message:n.path[0]==="answers"&&typeof n.path[1]=="number"&&(t.answers[n.path[1]]=n.message);Q(t)},[u,i]);const M=(s,t,n)=>{const v=[...i];v[s][t]=n,x(v),h(w=>({...w,answers:w.answers.map((F,K)=>s===K?!0:F)}))},A=s=>{if(s.preventDefault(),!q.safeParse({question:u,answers:i}).success){h({question:!0,answers:[!0,!0,!0,!0]});return}j.mutate({question:u,answers:i})};return E?e.jsx("div",{className:"p-10 text-center text-gray-300",children:e.jsx(k,{})}):C?e.jsx("div",{children:"Hiba a betöltésnél."}):e.jsxs(e.Fragment,{children:[e.jsx(D,{}),N&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center",style:{backgroundColor:"rgba(25, 25, 30, 0.3)"},children:e.jsx(k,{})}),e.jsx("div",{className:"max-w-4xl mx-auto mt-10",children:e.jsx(H,{error:null,success:z,label:"Kérdés szerkesztése",children:e.jsxs("form",{onSubmit:A,className:"space-y-6",children:[e.jsx(G,{question:u,setQuestion:d,fieldErrors:g,touched:p}),e.jsxs("div",{children:[e.jsx("label",{className:"block mb-2 font-medium",children:"Válaszok"}),i.map((s,t)=>e.jsx(J,{answer:s,index:t,updateAnswer:M,fieldErrors:g.answers[t],touched:p.answers[t]},t))]}),e.jsx(R,{isPending:j.isPending,label:"Mentés"})]})})})]})}export{ee as M};
